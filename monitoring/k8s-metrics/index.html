<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="k8s-metrics
"><meta name=author content=fuyuanyuan><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.6"><title>k8s-metrics - fuyuanyuan Documentations</title><link rel=stylesheet href=../../assets/stylesheets/main.35e1ed30.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css><link rel=stylesheet href=https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css><link rel=stylesheet href=https://cdn.tonycrane.cc/lxgw/lxgwscreen.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap"><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config",""),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link rel=stylesheet href=../../assets/stylesheets/custom.00c04c01.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#k8s class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label=不再显示此消息> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> For updates follow <strong>@hrgame</strong> on <a rel=me href=https://fosstodon.org/@squidfunk> <span class="twemoji mastodon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </span> <strong>Fosstodon</strong> </a> and <a href=https://twitter.com/hrgame> <span class="twemoji twitter"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </span> <strong>Twitter</strong> </a> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title="fuyuanyuan Documentations" class="md-header__button md-logo" aria-label="fuyuanyuan Documentations" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> fuyuanyuan Documentations </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> k8s-metrics </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../prometheus-intro/ class=md-tabs__link> Monitoring </a> </li> <li class=md-tabs__item> <a href=../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="fuyuanyuan Documentations" class="md-nav__button md-logo" aria-label="fuyuanyuan Documentations" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> fuyuanyuan Documentations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Monitoring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../prometheus-intro/ class=md-nav__link> <span class=md-ellipsis> prometheus介绍 </span> </a> </li> <li class=md-nav__item> <a href=../prometheus-install/ class=md-nav__link> <span class=md-ellipsis> prometheus安装 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../blog/ class="md-nav__link "> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blog/archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blog/category/tools/ class=md-nav__link> <span class=md-ellipsis> tools </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#k8s class=md-nav__link> K8S监控指标 </a> <nav class=md-nav aria-label=K8S监控指标> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kube-state-metrics class=md-nav__link> kube-state-metrics </a> <nav class=md-nav aria-label=kube-state-metrics> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pod-metrics class=md-nav__link> pod-metrics </a> <nav class=md-nav aria-label=pod-metrics> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 使用场景 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployment-metrics class=md-nav__link> deployment-metrics </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cadvisor class=md-nav__link> cAdvisor </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#k8s_1 class=md-nav__link> K8S监控语句 </a> <nav class=md-nav aria-label=K8S监控语句> <ul class=md-nav__list> <li class=md-nav__item> <a href=#k8s_2 class=md-nav__link> k8s负载 </a> <nav class=md-nav aria-label=k8s负载> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubepodcrashlooping class=md-nav__link> KubePodCrashLooping </a> </li> <li class=md-nav__item> <a href=#kubepodnotready class=md-nav__link> KubePodNotReady </a> </li> <li class=md-nav__item> <a href=#kubedeploymentgenerationmismatch class=md-nav__link> KubeDeploymentGenerationMismatch </a> </li> <li class=md-nav__item> <a href=#kubedeploymentreplicasmismatch class=md-nav__link> KubeDeploymentReplicasMismatch </a> </li> <li class=md-nav__item> <a href=#kubestatefulsetreplicasmismatch class=md-nav__link> KubeStatefulSetReplicasMismatch </a> </li> <li class=md-nav__item> <a href=#kubestatefulsetgenerationmismatch class=md-nav__link> KubeStatefulSetGenerationMismatch </a> </li> <li class=md-nav__item> <a href=#kubestatefulsetupdatenotrolledout class=md-nav__link> KubeStatefulSetUpdateNotRolledOut </a> </li> <li class=md-nav__item> <a href=#kubedaemonsetrolloutstuck class=md-nav__link> KubeDaemonSetRolloutStuck </a> </li> <li class=md-nav__item> <a href=#kubecontainerwaiting class=md-nav__link> KubeContainerWaiting </a> </li> <li class=md-nav__item> <a href=#kubedaemonsetnotscheduled class=md-nav__link> KubeDaemonSetNotScheduled </a> </li> <li class=md-nav__item> <a href=#kubedaemonsetmisscheduled class=md-nav__link> KubeDaemonSetMisScheduled </a> </li> <li class=md-nav__item> <a href=#kubejobcompletion class=md-nav__link> KubeJobCompletion </a> </li> <li class=md-nav__item> <a href=#kubejobfailed class=md-nav__link> KubeJobFailed </a> </li> <li class=md-nav__item> <a href=#kubehpareplicasmismatch class=md-nav__link> KubeHpaReplicasMismatch </a> </li> <li class=md-nav__item> <a href=#kubehpamaxedout class=md-nav__link> KubeHpaMaxedOut </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#k8s_3 class=md-nav__link> k8s资源 </a> <nav class=md-nav aria-label=k8s资源> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubecpuovercommit class=md-nav__link> KubeCPUOvercommit </a> </li> <li class=md-nav__item> <a href=#kubememoryovercommit class=md-nav__link> KubeMemoryOvercommit </a> </li> <li class=md-nav__item> <a href=#kubecpuquotaovercommit class=md-nav__link> KubeCPUQuotaOvercommit </a> </li> <li class=md-nav__item> <a href=#kubememoryquotaovercommit class=md-nav__link> KubeMemoryQuotaOvercommit </a> </li> <li class=md-nav__item> <a href=#kubequotaalmostfull class=md-nav__link> KubeQuotaAlmostFull </a> </li> <li class=md-nav__item> <a href=#kubequotaexceeded class=md-nav__link> KubeQuotaExceeded </a> </li> <li class=md-nav__item> <a href=#runningpodnamespacepodnode class=md-nav__link> 查询处在RUNNING状态的pod的内存请求量总和，按照namespace、pod和node进行分组 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cadvisor_1 class=md-nav__link> CAdvisor </a> <nav class=md-nav aria-label=CAdvisor> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prometheus-container-metrics class=md-nav__link> Prometheus container metrics </a> <nav class=md-nav aria-label="Prometheus container metrics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hardware-metrics class=md-nav__link> hardware metrics </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 常用规则 </a> </li> <li class=md-nav__item> <a href=#podcpulimitrate class=md-nav__link> PodCPULimitRate </a> </li> <li class=md-nav__item> <a href=#podcpurequestrate class=md-nav__link> PodCPURequestRate </a> </li> <li class=md-nav__item> <a href=#podmemorylimitrate class=md-nav__link> PodMemoryLimitRate </a> </li> <li class=md-nav__item> <a href=#podmemoryrequestrate class=md-nav__link> PodMemoryRequestRate </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 参考 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a href=../../tags/#metrics class=md-tag>metrics</a> <a href=../../tags/#kube-state-metrics class=md-tag>kube-state-metrics</a> <a href=../../tags/#cadvisor class=md-tag>cadvisor</a> </nav> <h2 id=k8s>K8S监控指标<a class=headerlink href=#k8s title="Permanent link">&para;</a></h2> <h3 id=kube-state-metrics>kube-state-metrics<a class=headerlink href=#kube-state-metrics title="Permanent link">&para;</a></h3> <p>官方文档 <a href=https://github.com/kubernetes/kube-state-metrics/blob/main/docs/README.md>https://github.com/kubernetes/kube-state-metrics/blob/main/docs/README.md</a></p> <h4 id=pod-metrics>pod-metrics<a class=headerlink href=#pod-metrics title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Metric name</th> <th>Metric type</th> <th>Description</th> <th>Unit (where applicable)</th> <th>Labels/tags</th> <th>Status</th> <th>Opt-in</th> </tr> </thead> <tbody> <tr> <td>kube_pod_annotations</td> <td>Gauge</td> <td>Kubernetes annotations converted to Prometheus labels controlled via <a href=./cli-arguments.md>--metric-annotations-allowlist</a></td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>annotation_POD_ANNOTATION</code>=&lt;POD_ANNOTATION&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_info</td> <td>Gauge</td> <td>Information about pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>host_ip</code>=&lt;host-ip&gt; <br> <code>pod_ip</code>=&lt;pod-ip&gt; <br> <code>node</code>=&lt;node-name&gt;<br> <code>created_by_kind</code>=&lt;created_by_kind&gt;<br> <code>created_by_name</code>=&lt;created_by_name&gt;<br> <code>uid</code>=&lt;pod-uid&gt;<br> <code>priority_class</code>=&lt;priority_class&gt;<br> <code>host_network</code>=&lt;host_network&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_ips</td> <td>Gauge</td> <td>Pod IP addresses</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>ip</code>=&lt;pod-ip-address&gt; <br> <code>ip_family</code>=&lt;4 OR 6&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_start_time</td> <td>Gauge</td> <td>Start time in unix timestamp for a pod</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_completion_time</td> <td>Gauge</td> <td>Completion time in unix timestamp for a pod</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_owner</td> <td>Gauge</td> <td>Information about the Pod's owner</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>owner_kind</code>=&lt;owner kind&gt; <br> <code>owner_name</code>=&lt;owner name&gt; <br> <code>owner_is_controller</code>=&lt;whether owner is controller&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_labels</td> <td>Gauge</td> <td>Kubernetes labels converted to Prometheus labels controlled via <a href=./cli-arguments.md>--metric-labels-allowlist</a></td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>label_POD_LABEL</code>=&lt;POD_LABEL&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_nodeselectors</td> <td>Gauge</td> <td>Describes the Pod nodeSelectors</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>nodeselector_NODE_SELECTOR</code>=&lt;NODE_SELECTOR&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>Opt-in</td> </tr> <tr> <td>kube_pod_status_phase</td> <td>Gauge</td> <td>The pods current phase</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>phase</code>=&lt;Pending|Running|Succeeded|Failed|Unknown&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_status_qos_class</td> <td>Gauge</td> <td>The pods current qosClass</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>qos_class</code>=&lt;BestEffort|Burstable|Guaranteed&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_status_ready</td> <td>Gauge</td> <td>Describes whether the pod is ready to serve requests</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>condition</code>=&lt;true|false|unknown&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_status_scheduled</td> <td>Gauge</td> <td>Describes the status of the scheduling process for the pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>condition</code>=&lt;true|false|unknown&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_info</td> <td>Gauge</td> <td>Information about a container in a pod</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>image</code>=&lt;image-name&gt; <br> <code>image_id</code>=&lt;image-id&gt; <br> <code>image_spec</code>=&lt;image-spec&gt; <br> <code>container_id</code>=&lt;containerid&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_waiting</td> <td>Gauge</td> <td>Describes whether the container is currently in waiting state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_waiting_reason</td> <td>Gauge</td> <td>Describes the reason the container is currently in waiting state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;container-waiting-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_running</td> <td>Gauge</td> <td>Describes whether the container is currently in running state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_state_started</td> <td>Gauge</td> <td>Start time in unix timestamp for a pod container</td> <td>seconds</td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_terminated</td> <td>Gauge</td> <td>Describes whether the container is currently in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_terminated_reason</td> <td>Gauge</td> <td>Describes the reason the container is currently in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;container-terminated-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_last_terminated_reason</td> <td>Gauge</td> <td>Describes the last reason the container was in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;last-terminated-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_last_terminated_exitcode</td> <td>Gauge</td> <td>Describes the exit code for the last container in terminated state.</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_container_status_ready</td> <td>Gauge</td> <td>Describes whether the containers readiness check succeeded</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_status_initialized_time</td> <td>Gauge</td> <td>Time when the pod is initialized.</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td></td> </tr> <tr> <td>kube_pod_status_ready_time</td> <td>Gauge</td> <td>Time when pod passed readiness probes.</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td></td> </tr> <tr> <td>kube_pod_status_container_ready_time</td> <td>Gauge</td> <td>Time when the container of the pod entered Ready state.</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td></td> </tr> <tr> <td>kube_pod_container_status_restarts_total</td> <td>Counter</td> <td>The number of container restarts per container</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_container_resource_requests</td> <td>Gauge</td> <td>The number of requested request resource by a container. It is recommended to use the <code>kube_pod_resource_requests</code> metric exposed by kube-scheduler instead, as it is more precise.</td> <td><code>cpu</code>=&lt;core&gt; <br> <code>memory</code>=&lt;bytes&gt;</td> <td><code>resource</code>=&lt;resource-name&gt; <br> <code>unit</code>=&lt;resource-unit&gt; <br> <code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>node</code>=&lt; node-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_container_resource_limits</td> <td>Gauge</td> <td>The number of requested limit resource by a container. It is recommended to use the <code>kube_pod_resource_limits</code> metric exposed by kube-scheduler instead, as it is more precise.</td> <td><code>cpu</code>=&lt;core&gt; <br> <code>memory</code>=&lt;bytes&gt;</td> <td><code>resource</code>=&lt;resource-name&gt; <br> <code>unit</code>=&lt;resource-unit&gt; <br> <code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>node</code>=&lt; node-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_overhead_cpu_cores</td> <td>Gauge</td> <td>The pod overhead in regards to cpu cores associated with running a pod</td> <td>core</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_overhead_memory_bytes</td> <td>Gauge</td> <td>The pod overhead in regards to memory associated with running a pod</td> <td>bytes</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_runtimeclass_name_info</td> <td>Gauge</td> <td>The runtimeclass associated with the pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_created</td> <td>Gauge</td> <td>Unix creation timestamp</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_deletion_timestamp</td> <td>Gauge</td> <td>Unix deletion timestamp</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_restart_policy</td> <td>Gauge</td> <td>Describes the restart policy in use by this pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>type</code>=&lt;Always|Never|OnFailure&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_info</td> <td>Gauge</td> <td>Information about an init container in a pod</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>image</code>=&lt;image-name&gt; <br> <code>image_id</code>=&lt;image-id&gt; <br> <code>image_spec</code>=&lt;image-spec&gt; <br> <code>container_id</code>=&lt;containerid&gt; <br> <code>uid</code>=&lt;pod-uid&gt; <br> <code>restart_policy</code>=&lt;restart-policy&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_waiting</td> <td>Gauge</td> <td>Describes whether the init container is currently in waiting state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_waiting_reason</td> <td>Gauge</td> <td>Describes the reason the init container is currently in waiting state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;container-waiting-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_running</td> <td>Gauge</td> <td>Describes whether the init container is currently in running state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_terminated</td> <td>Gauge</td> <td>Describes whether the init container is currently in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_terminated_reason</td> <td>Gauge</td> <td>Describes the reason the init container is currently in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;container-terminated-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_last_terminated_reason</td> <td>Gauge</td> <td>Describes the last reason the init container was in terminated state</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;last-terminated-reason&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_ready</td> <td>Gauge</td> <td>Describes whether the init containers readiness check succeeded</td> <td></td> <td><code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_status_restarts_total</td> <td>Counter</td> <td>The number of restarts for the init container</td> <td>integer</td> <td><code>container</code>=&lt;container-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_resource_limits</td> <td>Gauge</td> <td>The number of CPU cores requested limit by an init container</td> <td><code>cpu</code>=&lt;core&gt; <br> <code>memory</code>=&lt;bytes&gt;</td> <td><code>resource</code>=&lt;resource-name&gt; <br> <code>unit</code>=&lt;resource-unit&gt; <br> <code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>node</code>=&lt; node-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_init_container_resource_requests</td> <td>Gauge</td> <td>The number of CPU cores requested by an init container</td> <td><code>cpu</code>=&lt;core&gt; <br> <code>memory</code>=&lt;bytes&gt;</td> <td><code>resource</code>=&lt;resource-name&gt; <br> <code>unit</code>=&lt;resource-unit&gt; <br> <code>container</code>=&lt;container-name&gt; <br> <code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>node</code>=&lt; node-name&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_spec_volumes_persistentvolumeclaims_info</td> <td>Gauge</td> <td>Information about persistentvolumeclaim volumes in a pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>volume</code>=&lt;volume-name&gt; <br> <code>persistentvolumeclaim</code>=&lt;persistentvolumeclaim-claimname&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_spec_volumes_persistentvolumeclaims_readonly</td> <td>Gauge</td> <td>Describes whether a persistentvolumeclaim is mounted read only</td> <td>bool</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>volume</code>=&lt;volume-name&gt; <br> <code>persistentvolumeclaim</code>=&lt;persistentvolumeclaim-claimname&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_status_reason</td> <td>Gauge</td> <td>The pod status reasons</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>reason</code>=&lt;Evicted|NodeAffinity|NodeLost|Shutdown|UnexpectedAdmissionError&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_status_scheduled_time</td> <td>Gauge</td> <td>Unix timestamp when pod moved into scheduled status</td> <td>seconds</td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_status_unschedulable</td> <td>Gauge</td> <td>Describes the unschedulable status for the pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt;</td> <td>STABLE</td> <td>-</td> </tr> <tr> <td>kube_pod_tolerations</td> <td>Gauge</td> <td>Information about the pod tolerations</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt; <br> <code>key</code>=&lt;toleration-key&gt; <br> <code>operator</code>=&lt;toleration-operator&gt; <br> <code>value</code>=&lt;toleration-value&gt; <br> <code>effect</code>=&lt;toleration-effect&gt; <code>toleration_seconds</code>=&lt;toleration-seconds&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_service_account</td> <td>Gauge</td> <td>The service account for a pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt; <br> <code>service_account</code>=&lt;service_account&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> <tr> <td>kube_pod_scheduler</td> <td>Gauge</td> <td>The scheduler for a pod</td> <td></td> <td><code>pod</code>=&lt;pod-name&gt; <br> <code>namespace</code>=&lt;pod-namespace&gt; <br> <code>uid</code>=&lt;pod-uid&gt; <br> <code>name</code>=&lt;scheduler-name&gt;</td> <td>EXPERIMENTAL</td> <td>-</td> </tr> </tbody> </table> <h5 id=_1>使用场景<a class=headerlink href=#_1 title="Permanent link">&para;</a></h5> <ul> <li>获取pod在 <code>Unknown</code>状态 <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>sum(kube_pod_status_phase{phase=&quot;Unknown&quot;}) by (namespace, pod) or (count(kube_pod_deletion_timestamp) by (namespace, pod) * sum(kube_pod_status_reason{reason=&quot;NodeLost&quot;}) by(namespace, pod)) &gt; 0
</span></code></pre></div></li> <li>获取pod在 <code>Terminating</code>状态 <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>count(kube_pod_deletion_timestamp) by (namespace, pod) * count(kube_pod_status_reason{reason=&quot;NodeLost&quot;} == 0) by (namespace, pod) &gt; 0
</span></code></pre></div></li> </ul> <h4 id=deployment-metrics>deployment-metrics<a class=headerlink href=#deployment-metrics title="Permanent link">&para;</a></h4> <h3 id=cadvisor>cAdvisor<a class=headerlink href=#cadvisor title="Permanent link">&para;</a></h3> <p>官网：<a href=https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md#prometheus-container-metrics>https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md#prometheus-container-metrics</a></p> <h2 id=k8s_1>K8S监控语句<a class=headerlink href=#k8s_1 title="Permanent link">&para;</a></h2> <h3 id=k8s_2>k8s负载<a class=headerlink href=#k8s_2 title="Permanent link">&para;</a></h3> <h4 id=kubepodcrashlooping>KubePodCrashLooping<a class=headerlink href=#kubepodcrashlooping title="Permanent link">&para;</a></h4> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>rate(kube_pod_container_status_restarts_total{job=&quot;kube-state-metrics&quot;}[5m]) * 60 * 5 &gt; 0
</span></code></pre></div> 或者 <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>changes(kube_pod_container_status_restarts_total[5m])&gt; 0
</span></code></pre></div> 报警信息</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/容器 {{ $labels.container}} 最近5分钟重启{{ printf "%.2f" $value }}次</p> </blockquote> <h4 id=kubepodnotready>KubePodNotReady<a class=headerlink href=#kubepodnotready title="Permanent link">&para;</a></h4> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>sum by (cluster,namespace, pod) (
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>  max by(cluster,namespace, pod) (
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    kube_pod_status_phase{job=&quot;kube-state-metrics&quot;, phase=~&quot;Pending|Unknown&quot;}
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>  ) * on(cluster,namespace, pod) group_left(owner_kind) topk by(cluster,namespace, pod) (
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    1, max by(cluster,namespace, pod, owner_kind) (kube_pod_owner{owner_kind!=&quot;Job&quot;})
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>  )
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>) &gt; 0
</span></code></pre></div> 在Kubernetes环境中检查是否存在处于"Pending"或"Unknown"状态的Pod，且这些Pod的所有者（owner）不是"Job"。</p> <ul> <li>sum by (cluster, namespace, pod): 首先对查询结果进行聚合，按照cluster、namespace和pod这三个标签进行分组。</li> <li>max by(cluster, namespace, pod): 在内部，对于每个cluster、namespace和pod的组合，找到满足条件的Pod中最大的值。</li> <li>这里使用的是kube_pod_status_phase{job="kube-state-metrics", phase=~"Pending|Unknown"}查询，它会返回处于"Pending"或"Unknown"状态的Pod。</li> <li>on(cluster, namespace, pod) group_left(owner_kind): 使用on关键字指定了需要与前面的结果进行关联的标签，这里是cluster、namespace和pod。</li> <li>group_left确保保留左侧查询（即前面的查询）中的标签，并与右侧查询（即后面的查询）进行关联。</li> <li>topk by(cluster, namespace, pod):对于每个cluster、namespace和pod的组合，找到满足条件的Pod的所有者，并只选择一个。 topk函数用于选择满足条件的最顶部的记录。这里选择的是前一个查询中的Pod的所有者。</li> <li>1, max by(cluster, namespace, pod, owner_kind) (kube_pod_owner{owner_kind!="Job"}): 这是一个子查询，它查找满足条件的Pod的所有者，并确保这些所有者不是"Job"。 使用max by确保对于每个cluster、namespace、pod和owner_kind的组合，找到最大的值（在这里，我们只是查找任意一个满足条件的记录）。</li> <li><code>&gt; 0</code>: 最后，主查询确保结果大于0。这意味着如果找到任何满足条件的Pod，且它的所有者不是"Job"，则结果为真。 综上所述，这段查询语句用于检查Kubernetes集群中是否存在处于"Pending"或"Unknown"状态的Pod，并且这些Pod的所有者不是"Job"。如果存在这样的Pod，查询结果将为真。</li> </ul> <p>报警信息</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}处于NotReady状态超过15分钟</p> </blockquote> <h4 id=kubedeploymentgenerationmismatch>KubeDeploymentGenerationMismatch<a class=headerlink href=#kubedeploymentgenerationmismatch title="Permanent link">&para;</a></h4> <p>出现部署版本不匹配 <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>kube_deployment_status_observed_generation{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>  !=
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>kube_deployment_metadata_generation{job=&quot;kube-state-metrics&quot;}
</span></code></pre></div> 告警信息</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/deployment {{ $labels.deployment}}部署版本不符合预期，表示Deployment变更没有生效</p> </blockquote> <h4 id=kubedeploymentreplicasmismatch>KubeDeploymentReplicasMismatch<a class=headerlink href=#kubedeploymentreplicasmismatch title="Permanent link">&para;</a></h4> <p>出现部署副本不匹配。 <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>(
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>  kube_deployment_spec_replicas{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    !=
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>  kube_deployment_status_replicas_available{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>) and (
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>  changes(kube_deployment_status_replicas_updated{job=&quot;kube-state-metrics&quot;}[5m])
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    ==
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>  0
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>)
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/deployment {{ $labels.deployment }} 没有达到预期副本数超过5分钟</p> </blockquote> <h4 id=kubestatefulsetreplicasmismatch>KubeStatefulSetReplicasMismatch<a class=headerlink href=#kubestatefulsetreplicasmismatch title="Permanent link">&para;</a></h4> <p>状态集副本不匹配。 <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>(
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>  kube_statefulset_status_replicas_ready{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    !=
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>  kube_statefulset_status_replicas{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>) and (
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>  changes(kube_statefulset_status_replicas_updated{job=&quot;kube-state-metrics&quot;}[5m])
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    ==
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>  0
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>)
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset }} 没有达到预期副本数超过5分钟</p> </blockquote> <h4 id=kubestatefulsetgenerationmismatch>KubeStatefulSetGenerationMismatch<a class=headerlink href=#kubestatefulsetgenerationmismatch title="Permanent link">&para;</a></h4> <p>状态集版本不匹配。 <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>kube_statefulset_status_observed_generation{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>  !=
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>kube_statefulset_metadata_generation{job=&quot;kube-state-metrics&quot;}
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset}} 部署版本不符合预期，表示statefulset变更没有生效</p> </blockquote> <h4 id=kubestatefulsetupdatenotrolledout>KubeStatefulSetUpdateNotRolledOut<a class=headerlink href=#kubestatefulsetupdatenotrolledout title="Permanent link">&para;</a></h4> <p>状态集更新未退出。 <div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>(
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>  max without (revision) (
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    kube_statefulset_status_current_revision{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>      unless
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    kube_statefulset_status_update_revision{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>  )
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    *
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>  (
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    kube_statefulset_replicas{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>      !=
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>    kube_statefulset_status_replicas_updated{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>  )
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>)  and (
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>  changes(kube_statefulset_status_replicas_updated{job=&quot;kube-state-metrics&quot;}[5m])
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>    ==
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>  0
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>)
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset }} 部分Pod未更新</p> </blockquote> <h4 id=kubedaemonsetrolloutstuck>KubeDaemonSetRolloutStuck<a class=headerlink href=#kubedaemonsetrolloutstuck title="Permanent link">&para;</a></h4> <p>DaemonSet退出回退。 <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>(
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>  (
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    kube_daemonset_status_current_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>     !=
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    kube_daemonset_status_desired_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>  ) or (
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>    kube_daemonset_status_number_misscheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>     !=
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    0
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>  ) or (
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    kube_daemonset_updated_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>     !=
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    kube_daemonset_status_desired_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>  ) or (
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>    kube_daemonset_status_number_available{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>     !=
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    kube_daemonset_status_desired_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>  )
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>) and (
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>  changes(kube_daemonset_updated_number_scheduled{job=&quot;kube-state-metrics&quot;}[5m])
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>    ==
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>  0
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>)
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset }} 变更卡了超过5分钟</p> </blockquote> <h4 id=kubecontainerwaiting>KubeContainerWaiting<a class=headerlink href=#kubecontainerwaiting title="Permanent link">&para;</a></h4> <p>容器等待。 <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>sum by (namespace, pod, container,cluster) (kube_pod_container_status_waiting_reason{job=&quot;kube-state-metrics&quot;}) &gt; 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/pod {{ $labels.pod }}/container {{ $labels.container}} 处于Waiting状态超过10分钟</p> </blockquote> <h4 id=kubedaemonsetnotscheduled>KubeDaemonSetNotScheduled<a class=headerlink href=#kubedaemonsetnotscheduled title="Permanent link">&para;</a></h4> <p>DaemonSet无计划 <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>kube_daemonset_status_desired_number_scheduled{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>  -
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>kube_daemonset_status_current_number_scheduled{job=&quot;kube-state-metrics&quot;} &gt; 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/ namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset}} 中 {{ $value }} 个 pod 没有被调度</p> </blockquote> <h4 id=kubedaemonsetmisscheduled>KubeDaemonSetMisScheduled<a class=headerlink href=#kubedaemonsetmisscheduled title="Permanent link">&para;</a></h4> <p>Daemon缺失计划 <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>kube_daemonset_status_number_misscheduled{job=&quot;kube-state-metrics&quot;} &gt; 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset}} 中 {{ $value }} 个 pod 错误调度到node上</p> </blockquote> <h4 id=kubejobcompletion>KubeJobCompletion<a class=headerlink href=#kubejobcompletion title="Permanent link">&para;</a></h4> <p>任务完成 <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>kube_job_spec_completions{job=&quot;kube-state-metrics&quot;} - kube_job_status_succeeded{job=&quot;kube-state-metrics&quot;}  &gt; 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/job {{ $labels.job_name }} 任务完成</p> </blockquote> <h4 id=kubejobfailed>KubeJobFailed<a class=headerlink href=#kubejobfailed title="Permanent link">&para;</a></h4> <p>任务失败 <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>kube_job_status_failed{job=&quot;kube-state-metrics&quot;} &gt; 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/job {{ $labels.job_name }} 执行失败</p> </blockquote> <h4 id=kubehpareplicasmismatch>KubeHpaReplicasMismatch<a class=headerlink href=#kubehpareplicasmismatch title="Permanent link">&para;</a></h4> <p>HPA副本不匹配 <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>(kube_hpa_status_desired_replicas{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>  !=
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>kube_hpa_status_current_replicas{job=&quot;kube-state-metrics&quot;})
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>  and
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>changes(kube_hpa_status_current_replicas[10m]) == 0
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/HPA {{ $labels.hpa }} 副本数和预期不一致超过10分钟</p> </blockquote> <h4 id=kubehpamaxedout>KubeHpaMaxedOut<a class=headerlink href=#kubehpamaxedout title="Permanent link">&para;</a></h4> <p>HPA副本超过最大值 <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>kube_hpa_status_current_replicas{job=&quot;kube-state-metrics&quot;}
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>  ==
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>kube_hpa_spec_max_replicas{job=&quot;kube-state-metrics&quot;}
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/HPA {{ $labels.hpa }} 副本数达到最大值超过5m</p> </blockquote> <h3 id=k8s_3>k8s资源<a class=headerlink href=#k8s_3 title="Permanent link">&para;</a></h3> <h4 id=kubecpuovercommit>KubeCPUOvercommit<a class=headerlink href=#kubecpuovercommit title="Permanent link">&para;</a></h4> <p>CPU过载 <div class="language-text highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>sum(kube_pod_container_resource_requests_cpu_cores) by (cluster) /sum(kube_node_status_allocatable_cpu_cores) by (cluster)  &gt;
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>(count(kube_node_status_allocatable_cpu_cores) by (cluster) -1)   / count(kube_node_status_allocatable_cpu_cores) by (cluster) 
</span></code></pre></div></p> <p>新版本的Kube_state_metric语句 <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>sum(kube_pod_container_resource_requests{resource=&quot;cpu&quot;}) by (cluster)  
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>  /
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>sum(kube_node_status_allocatable{resource=&quot;cpu&quot;})
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a> by (cluster)  &gt;
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>(count(kube_node_status_allocatable{resource=&quot;cpu&quot;}) by (cluster) -1)   / count(kube_node_status_allocatable{resource=&quot;cpu&quot;}) by (cluster) 
</span></code></pre></div></p> <p>告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}内Pod申请的CPU过载，当前CPU申请占比{{ $value | humanizePercentage }}</p> </blockquote> <h4 id=kubememoryovercommit>KubeMemoryOvercommit<a class=headerlink href=#kubememoryovercommit title="Permanent link">&para;</a></h4> <p>内存过载 <div class="language-text highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>sum(namespace:kube_pod_container_resource_requests_memory_bytes:sum{}) by (cluster)  
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>  /
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>sum(kube_node_status_allocatable_memory_bytes) by (cluster)  
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>  &gt;
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>(count(kube_node_status_allocatable_memory_bytes) by (cluster)-1)  
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>  /
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>count(kube_node_status_allocatable_memory_bytes) by (cluster)  
</span></code></pre></div></p> <p>新版本的Kube_state_metric语句 sum(kube_pod_container_resource_requests{resource="memory"}) by (cluster)<br> / sum(kube_node_status_allocatable{resource="memory"}) by (cluster) </p> <blockquote> <p>(count(kube_node_status_allocatable{resource="memory"}) by (cluster)-1)<br> / count(kube_node_status_allocatable{resource="memory"}) by (cluster) </p> </blockquote> <p>告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}内Pod申请的内存过载，当前CPU申请占比{{ $value | humanizePercentage }}</p> </blockquote> <h4 id=kubecpuquotaovercommit>KubeCPUQuotaOvercommit<a class=headerlink href=#kubecpuquotaovercommit title="Permanent link">&para;</a></h4> <p>CPU额度过载（kube_resourcequota不存在，从resourcequota-metrics中 采集） <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>sum(kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;hard&quot;, resource=&quot;cpu&quot;})  by (cluster)  
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>  /
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>sum(kube_node_status_allocatable_cpu_cores) by (cluster)  
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>  &gt; 1.5
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}CPU Quota过载，已经超过可分配CPU资源的{{ $value }}倍</p> </blockquote> <h4 id=kubememoryquotaovercommit>KubeMemoryQuotaOvercommit<a class=headerlink href=#kubememoryquotaovercommit title="Permanent link">&para;</a></h4> <p>内存额度过载（kube_resourcequota不存在，从resourcequota-metrics中 采集） <div class="language-text highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>sum(kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;hard&quot;, resource=&quot;memory&quot;}) by (cluster)  
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>  /
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>sum(kube_node_status_allocatable_memory_bytes{job=&quot;node-exporter&quot;}) by (cluster)   
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>  &gt; 1.5
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}内存配额过载，已经超过可分配内存资源的{{ $value }}倍</p> </blockquote> <h4 id=kubequotaalmostfull>KubeQuotaAlmostFull<a class=headerlink href=#kubequotaalmostfull title="Permanent link">&para;</a></h4> <p>配额快超过限制了 <div class="language-text highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;used&quot;}
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>  / ignoring(instance, job, type)
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>(kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;hard&quot;} &gt; 0)
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>  &gt; 0.7 
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}中资源{{ $labels.resource }}使用率超过{{ $value | humanizePercentage }}</p> </blockquote> <h4 id=kubequotaexceeded>KubeQuotaExceeded<a class=headerlink href=#kubequotaexceeded title="Permanent link">&para;</a></h4> <p>配额超限制了 <div class="language-text highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;used&quot;}
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>  / ignoring(instance, job, type)
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>(kube_resourcequota{job=&quot;kube-state-metrics&quot;, type=&quot;hard&quot;} &gt; 0)
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>  &gt; 1
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}中资源{{ $labels.resource }}使用率超过{{ $value | humanizePercentage }}</p> </blockquote> <h4 id=runningpodnamespacepodnode>查询处在RUNNING状态的pod的内存请求量总和，按照namespace、pod和node进行分组<a class=headerlink href=#runningpodnamespacepodnode title="Permanent link">&para;</a></h4> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>sum(kube_pod_container_resource_requests{resource=&quot;memory&quot;}) by (namespace, pod, node)
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>  * on (namespace, pod) group_left() (sum(kube_pod_status_phase{phase=&quot;Running&quot;}) by (pod, namespace) == 1)
</span></code></pre></div> - sum(kube_pod_container_resource_requests{resource="memory"}) by (namespace, pod, node): 这部分查询是对每个命名空间（namespace）、Pod和节点（node）的内存请求进行求和。 - kube_pod_container_resource_requests{resource="memory"}这部分是从kube-state-metrics获取的，它会返回每个Pod容器的内存请求。 - on (namespace, pod) group_left(): 使用on关键字指定了需要与前面的结果进行关联的标签，这里是namespace和pod。 group_left()确保保留左侧查询中的标签，并与右侧查询进行关联，但在此例中，右侧查询不需要额外的标签。 - (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1): 这是一个子查询，它检查每个Pod是否处于"Running"状态。 使用sum对每个Pod和命名空间的"Running"状态进行求和。由于Pod的状态只能是0或1，所以这个求和的结果要么是0（表示没有Pod处于"Running"状态），要么是1（表示有一个Pod处于"Running"状态）。 - == 1确保只选择处于"Running"状态的Pod。 - 最终，两个查询结果的乘积：这意味着我们希望查找满足两个条件的Pod：一是它们请求了内存资源，二是它们处于"Running"状态。</p> <h3 id=cadvisor_1>CAdvisor<a class=headerlink href=#cadvisor_1 title="Permanent link">&para;</a></h3> <p>官网文档：<a href=https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md>https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md</a></p> <h4 id=prometheus-container-metrics>Prometheus container metrics<a class=headerlink href=#prometheus-container-metrics title="Permanent link">&para;</a></h4> <p>The table below lists the Prometheus container metrics exposed by cAdvisor (in alphabetical order by metric name) and corresponding <code>-disable_metrics</code> / <code>-enable_metrics</code> option parameter:</p> <table> <thead> <tr> <th style="text-align: left;">Metric name</th> <th style="text-align: left;">Type</th> <th style="text-align: left;">Description</th> <th style="text-align: left;">Unit (where applicable)</th> <th style="text-align: left;">option parameter</th> <th style="text-align: left;">additional build flag</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;"><code>container_blkio_device_usage_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Blkio device bytes usage</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_cfs_periods_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Number of elapsed enforcement period intervals</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_cfs_throttled_periods_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Number of throttled period intervals</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_cfs_throttled_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Total time duration the container has been throttled</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_load_average_10s</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Value of container cpu load average over the last 10 seconds</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpuLoad</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_schedstat_run_periods_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Number of times processes of the cgroup have run on the cpu</td> <td style="text-align: left;"></td> <td style="text-align: left;">sched</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_schedstat_runqueue_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Time duration processes of the container have been waiting on a runqueue</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">sched</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_schedstat_run_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Time duration the processes of the container have run on the CPU</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">sched</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_system_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative system cpu time consumed</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_usage_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative cpu time consumed</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_cpu_user_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative user cpu time consumed</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">cpu</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_file_descriptors</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of open file descriptors for the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_inodes_free</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of available Inodes</td> <td style="text-align: left;"></td> <td style="text-align: left;">disk</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_inodes_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Total number of Inodes</td> <td style="text-align: left;"></td> <td style="text-align: left;">disk</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_io_current</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of I/Os currently in progress</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_io_time_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of seconds spent doing I/Os</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_io_time_weighted_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative weighted I/O time</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_limit_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of bytes that can be consumed by the container on this filesystem</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">disk</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_reads_bytes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of bytes read</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_read_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of seconds spent reading</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_reads_merged_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of reads merged</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_reads_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of reads completed</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_sector_reads_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of sector reads completed</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_sector_writes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of sector writes completed</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_usage_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of bytes that are consumed by the container on this filesystem</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">disk</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_writes_bytes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of bytes written</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_write_seconds_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of seconds spent writing</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_writes_merged_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of writes merged</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_fs_writes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of writes completed</td> <td style="text-align: left;"></td> <td style="text-align: left;">diskIO</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_hugetlb_failcnt</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Number of hugepage usage hits limits</td> <td style="text-align: left;"></td> <td style="text-align: left;">hugetlb</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_hugetlb_max_usage_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Maximum hugepage usages recorded</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">hugetlb</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_hugetlb_usage_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Current hugepage usage</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">hugetlb</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_last_seen</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Last time a container was seen by the exporter</td> <td style="text-align: left;">timestamp</td> <td style="text-align: left;">-</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_llc_occupancy_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Last level cache usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM).</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">resctrl</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_bandwidth_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Total memory bandwidth usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM).</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">resctrl</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_bandwidth_local_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Local memory bandwidth usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM).</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">resctrl</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_cache</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Total page cache memory</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_failcnt</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Number of memory usage hits limits</td> <td style="text-align: left;"></td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_failures_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of memory allocation failures</td> <td style="text-align: left;"></td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_mapped_file</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Size of memory mapped files</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_max_usage_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Maximum memory usage recorded</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_migrate</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Memory migrate status</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpuset</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_numa_pages</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of used pages per NUMA node</td> <td style="text-align: left;"></td> <td style="text-align: left;">memory_numa</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_rss</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Size of RSS</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_swap</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Container swap usage</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_usage_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Current memory usage, including all memory regardless of when it was accessed</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_memory_working_set_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Current working set</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_advance_tcp_stats_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">advanced tcp connections statistic for container</td> <td style="text-align: left;"></td> <td style="text-align: left;">advtcp</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_receive_bytes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of bytes received</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_receive_errors_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of errors encountered while receiving</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_receive_packets_dropped_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of packets dropped while receiving</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_receive_packets_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of packets received</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_tcp6_usage_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">tcp6 connection usage statistic for container</td> <td style="text-align: left;"></td> <td style="text-align: left;">tcp</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_tcp_usage_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">tcp connection usage statistic for container</td> <td style="text-align: left;"></td> <td style="text-align: left;">tcp</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_transmit_bytes_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of bytes transmitted</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_transmit_errors_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of errors encountered while transmitting</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_transmit_packets_dropped_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of packets dropped while transmitting</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_transmit_packets_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Cumulative count of packets transmitted</td> <td style="text-align: left;"></td> <td style="text-align: left;">network</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_udp6_usage_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">udp6 connection usage statistic for container</td> <td style="text-align: left;"></td> <td style="text-align: left;">udp</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_network_udp_usage_total</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">udp connection usage statistic for container</td> <td style="text-align: left;"></td> <td style="text-align: left;">udp</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_oom_events_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Count of out of memory events observed for the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">oom_event</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_perf_events_scaling_ratio</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Scaling ratio for perf event counter (event can be identified by <code>event</code> label and <code>cpu</code> indicates the core for which event was measured). See <a href=../runtime_options.md#perf-events>perf event configuration</a>.</td> <td style="text-align: left;"></td> <td style="text-align: left;">perf_event</td> <td style="text-align: left;">libpfm</td> </tr> <tr> <td style="text-align: left;"><code>container_perf_events_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Scaled counter of perf core event (event can be identified by <code>event</code> label and <code>cpu</code> indicates the core for which event was measured). See <a href=../runtime_options.md#perf-events>perf event configuration</a>.</td> <td style="text-align: left;"></td> <td style="text-align: left;">perf_event</td> <td style="text-align: left;">libpfm</td> </tr> <tr> <td style="text-align: left;"><code>container_perf_uncore_events_scaling_ratio</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Scaling ratio for perf uncore event counter (event can be identified by <code>event</code> label, <code>pmu</code> and <code>socket</code> lables indicate the PMU and the CPU socket for which event was measured). See <a href=../runtime_options.md#perf-events>perf event configuration</a>. Metric exists only for main cgroup (id="/").</td> <td style="text-align: left;"></td> <td style="text-align: left;">perf_event</td> <td style="text-align: left;">libpfm</td> </tr> <tr> <td style="text-align: left;"><code>container_perf_uncore_events_total</code></td> <td style="text-align: left;">Counter</td> <td style="text-align: left;">Scaled counter of perf uncore event (event can be identified by <code>event</code> label, <code>pmu</code> and <code>socket</code> lables indicate the PMU and the CPU socket for which event was measured). See <a href=../runtime_options.md#perf-events>perf event configuration</a>). Metric exists only for main cgroup (id="/").</td> <td style="text-align: left;"></td> <td style="text-align: left;">perf_event</td> <td style="text-align: left;">libpfm</td> </tr> <tr> <td style="text-align: left;"><code>container_processes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of processes running inside the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_referenced_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Container referenced bytes during last measurements cycle based on Referenced field in /proc/smaps file, with /proc/PIDs/clear_refs set to 1 after defined number of cycles configured through <code>referenced_reset_interval</code> cAdvisor parameter.Warning: this is intrusive collection because can influence kernel page reclaim policy and add latency. Refer to <a href=https://github.com/brendangregg/wss#wsspl-referenced-page-flag>https://github.com/brendangregg/wss#wsspl-referenced-page-flag</a> for more details.</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">referenced_memory</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_sockets</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of open sockets for the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_cpu_period</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">CPU period of the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">-</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_cpu_quota</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">CPU quota of the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">-</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_cpu_shares</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">CPU share of the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">-</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_memory_limit_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Memory limit for the container</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">-</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_memory_reservation_limit_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Memory reservation limit for the container</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_spec_memory_swap_limit_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Memory swap limit for the container</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_start_time_seconds</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Start time of the container since unix epoch</td> <td style="text-align: left;">seconds</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_tasks_state</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of tasks in given state (<code>sleeping</code>, <code>running</code>, <code>stopped</code>, <code>uninterruptible</code>, or <code>ioawaiting</code>)</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpuLoad</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_threads</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of threads running inside the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_threads_max</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Maximum number of threads allowed inside the container</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>container_ulimits_soft</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Soft ulimit values for the container root process. Unlimited if -1, except priority and nice</td> <td style="text-align: left;"></td> <td style="text-align: left;">process</td> <td style="text-align: left;"></td> </tr> </tbody> </table> <h5 id=hardware-metrics>hardware metrics<a class=headerlink href=#hardware-metrics title="Permanent link">&para;</a></h5> <p>The table below lists the Prometheus hardware metrics exposed by cAdvisor (in alphabetical order by metric name) and corresponding <code>-disable_metrics</code> / <code>-enable_metrics</code> option parameter:</p> <table> <thead> <tr> <th style="text-align: left;">Metric name</th> <th style="text-align: left;">Type</th> <th style="text-align: left;">Description</th> <th style="text-align: left;">Unit (where applicable)</th> <th style="text-align: left;">option parameter</th> <th style="text-align: left;">addional build flag</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;"><code>machine_cpu_cache_capacity_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Cache size in bytes assigned to NUMA node and CPU core</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">cpu_topology</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_cpu_cores</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of logical CPU cores</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_cpu_physical_cores</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of physical CPU cores</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_cpu_sockets</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of CPU sockets</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_dimm_capacity_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Total RAM DIMM capacity (all types memory modules) value labeled by dimm type,<br>information is retrieved from sysfs edac per-DIMM API (/sys/devices/system/edac/mc/) introduced in kernel 3.6</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_dimm_count</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of RAM DIMM (all types memory modules) value labeled by dimm type,<br>information is retrieved from sysfs edac per-DIMM API (/sys/devices/system/edac/mc/) introduced in kernel 3.6</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_memory_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Amount of memory installed on the machine</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_swap_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Amount of swap memory available on the machine</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_node_distance</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Distance between NUMA node and target NUMA node</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpu_topology</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_node_hugepages_count</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Numer of hugepages assigned to NUMA node</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpu_topology</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_node_memory_capacity_bytes</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Amount of memory assigned to NUMA node</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;">cpu_topology</td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;"><code>machine_nvm_avg_power_budget_watts</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">NVM power budget</td> <td style="text-align: left;">watts</td> <td style="text-align: left;"></td> <td style="text-align: left;">libipmctl</td> </tr> <tr> <td style="text-align: left;"><code>machine_nvm_capacity</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">NVM capacity value labeled by NVM mode (memory mode or app direct mode)</td> <td style="text-align: left;">bytes</td> <td style="text-align: left;"></td> <td style="text-align: left;">libipmctl</td> </tr> <tr> <td style="text-align: left;"><code>machine_thread_siblings_count</code></td> <td style="text-align: left;">Gauge</td> <td style="text-align: left;">Number of CPU thread siblings</td> <td style="text-align: left;"></td> <td style="text-align: left;">cpu_topology</td> <td style="text-align: left;"></td> </tr> </tbody> </table> <h4 id=_2>常用规则<a class=headerlink href=#_2 title="Permanent link">&para;</a></h4> <h4 id=podcpulimitrate>PodCPULimitRate<a class=headerlink href=#podcpulimitrate title="Permanent link">&para;</a></h4> <p>pod cpu使用占limit的百分比 <div class="language-text highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>sum(rate(container_cpu_usage_seconds_total{job=&quot;cadvisor&quot;, image!=&quot;&quot;, container!=&quot;POD&quot;}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_limits_cpu_cores&gt;0) by (cluster, namespace, pod, container) &gt; 0.6
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}的CPU使用率(占limit)达{{ $value | humanizePercentage }}.</p> </blockquote> <h4 id=podcpurequestrate>PodCPURequestRate<a class=headerlink href=#podcpurequestrate title="Permanent link">&para;</a></h4> <p>pod cpu使用占request的百分比 <div class="language-text highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>sum(rate(container_cpu_usage_seconds_total{job=&quot;cadvisor&quot;, image!=&quot;&quot;, container!=&quot;POD&quot;}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_requests_cpu_cores&gt;0) by (cluster, namespace, pod, container) &gt; 0.8
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}的CPU使用率(占request)达{{ $value | humanizePercentage }}.</p> </blockquote> <h4 id=podmemorylimitrate>PodMemoryLimitRate<a class=headerlink href=#podmemorylimitrate title="Permanent link">&para;</a></h4> <p>pod 内存使用占limit的百分比 <div class="language-text highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>sum(rate(container_memory_working_set_bytes{job=&quot;cadvisor&quot;, image!=&quot;&quot;, container!=&quot;POD&quot;}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_limits_memory_bytes&gt;0) by (cluster, namespace, pod, container) &gt; 0.8
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}的内存使用率(占limit)达{{ $value | humanizePercentage }}.</p> </blockquote> <h4 id=podmemoryrequestrate>PodMemoryRequestRate<a class=headerlink href=#podmemoryrequestrate title="Permanent link">&para;</a></h4> <p>pod 内存使用占request的百分比 <div class="language-text highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>sum(rate(container_memory_working_set_bytes{job=&quot;cadvisor&quot;, image!=&quot;&quot;, container!=&quot;POD&quot;}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_requests_memory_bytes&gt;0) by (cluster, namespace, pod, container) &gt; 0.8
</span></code></pre></div> 告警内容</p> <blockquote> <p>集群{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container{{ $labels.container }}的内存使用率(占request)达{{ $value | humanizePercentage }}.</p> </blockquote> <h1 id=_3>参考<a class=headerlink href=#_3 title="Permanent link">&para;</a></h1> <p>kubenetes runbook: <a href=https://runbooks.prometheus-operator.dev/ >https://runbooks.prometheus-operator.dev/</a></p> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> 转载请注明出处。Copyright &copy; 2013 - 2024 fuyuanyuan. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=test target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.aecac24b.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js></script> <script src=../../assets/javascripts/custom.9c11c319.min.js></script> </body> </html>