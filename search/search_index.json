{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stemmer"]},"docs":[{"location":"tags/","title":"Tags","text":"<p>Following is a list of relevant tags:</p>"},{"location":"tags/#cadvisor","title":"cadvisor","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#install","title":"install","text":"<ul> <li>prometheus\u5b89\u88c5</li> </ul>"},{"location":"tags/#kube-state-metrics","title":"kube-state-metrics","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#metrics","title":"metrics","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#mkdocs","title":"mkdocs","text":"<ul> <li>mkdocs\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#prometheus","title":"prometheus","text":"<ul> <li>prometheus\u5b89\u88c5</li> <li>prometheus\u4ecb\u7ecd</li> </ul>"},{"location":"tags/#python","title":"python","text":"<ul> <li>python\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#tools","title":"tools","text":"<ul> <li>mkdocs\u5de5\u5177\u4fe1\u606f</li> <li>python\u5de5\u5177\u4fe1\u606f</li> <li>vscode\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#vscode","title":"vscode","text":"<ul> <li>vscode\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/2024/01/11/python/","title":"python\u5de5\u5177\u4fe1\u606f","text":"","tags":["tools","python"]},{"location":"blog/2024/01/11/python/#venv-","title":"venv -- \u521b\u5efa\u865a\u62df\u73af\u5883","text":"<p><pre><code># \u521b\u5efa\u865a\u62df\u73af\u5883\npython -m venv /path/to/new/virtual/environment\n</code></pre> \u53ef\u7528\u547d\u4ee4 <pre><code>usage: venv [-h] [--system-site-packages] [--symlinks | --copies] [--clear]\n            [--upgrade] [--without-pip] [--prompt PROMPT] [--upgrade-deps]\n            ENV_DIR [ENV_DIR ...]\n\nCreates virtual Python environments in one or more target directories.\n\npositional arguments:\n  ENV_DIR               A directory to create the environment in.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --system-site-packages\n                        Give the virtual environment access to the system\n                        site-packages dir.\n  --symlinks            Try to use symlinks rather than copies, when symlinks\n                        are not the default for the platform.\n  --copies              Try to use copies rather than symlinks, even when\n                        symlinks are the default for the platform.\n  --clear               Delete the contents of the environment directory if it\n                        already exists, before environment creation.\n  --upgrade             Upgrade the environment directory to use this version\n                        of Python, assuming Python has been upgraded in-place.\n  --without-pip         Skips installing or upgrading pip in the virtual\n                        environment (pip is bootstrapped by default)\n  --prompt PROMPT       Provides an alternative prompt prefix for this\n                        environment.\n  --upgrade-deps        Upgrade core dependencies (pip) to the\n                        latest version in PyPI\n\nOnce an environment has been created, you may wish to activate it, e.g. by\nsourcing an activate script in its bin directory.\n</code></pre> venv\u5b98\u65b9\u94fe\u63a5[]</p>","tags":["tools","python"]},{"location":"blog/2024/01/10/vscode/","title":"vscode\u5de5\u5177\u4fe1\u606f","text":"","tags":["tools","vscode"]},{"location":"blog/2024/01/10/vscode/#markdown","title":"markdown\u7f16\u8f91\u5668\u914d\u7f6e","text":"","tags":["tools","vscode"]},{"location":"monitoring/k8s-metrics/","title":"k8s-metrics","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#k8s","title":"K8S\u76d1\u63a7\u6307\u6807","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kube-state-metrics","title":"kube-state-metrics","text":"<p>\u5b98\u65b9\u6587\u6863 https://github.com/kubernetes/kube-state-metrics/blob/main/docs/README.md</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#pod-metrics","title":"pod-metrics","text":"Metric name Metric type Description Unit (where applicable) Labels/tags Status Opt-in kube_pod_annotations Gauge Kubernetes annotations converted to Prometheus labels controlled via --metric-annotations-allowlist <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>annotation_POD_ANNOTATION</code>=&lt;POD_ANNOTATION&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_info Gauge Information about pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>host_ip</code>=&lt;host-ip&gt;  <code>pod_ip</code>=&lt;pod-ip&gt;  <code>node</code>=&lt;node-name&gt; <code>created_by_kind</code>=&lt;created_by_kind&gt; <code>created_by_name</code>=&lt;created_by_name&gt; <code>uid</code>=&lt;pod-uid&gt; <code>priority_class</code>=&lt;priority_class&gt; <code>host_network</code>=&lt;host_network&gt; STABLE - kube_pod_ips Gauge Pod IP addresses <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>ip</code>=&lt;pod-ip-address&gt;  <code>ip_family</code>=&lt;4 OR 6&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_start_time Gauge Start time in unix timestamp for a pod seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_completion_time Gauge Completion time in unix timestamp for a pod seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_owner Gauge Information about the Pod's owner <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>owner_kind</code>=&lt;owner kind&gt;  <code>owner_name</code>=&lt;owner name&gt;  <code>owner_is_controller</code>=&lt;whether owner is controller&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_labels Gauge Kubernetes labels converted to Prometheus labels controlled via --metric-labels-allowlist <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>label_POD_LABEL</code>=&lt;POD_LABEL&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_nodeselectors Gauge Describes the Pod nodeSelectors <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>nodeselector_NODE_SELECTOR</code>=&lt;NODE_SELECTOR&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL Opt-in kube_pod_status_phase Gauge The pods current phase <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>phase</code>=&lt;Pending|Running|Succeeded|Failed|Unknown&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_status_qos_class Gauge The pods current qosClass <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>qos_class</code>=&lt;BestEffort|Burstable|Guaranteed&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_status_ready Gauge Describes whether the pod is ready to serve requests <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>condition</code>=&lt;true|false|unknown&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_status_scheduled Gauge Describes the status of the scheduling process for the pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>condition</code>=&lt;true|false|unknown&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_info Gauge Information about a container in a pod <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>image</code>=&lt;image-name&gt;  <code>image_id</code>=&lt;image-id&gt;  <code>image_spec</code>=&lt;image-spec&gt;  <code>container_id</code>=&lt;containerid&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_status_waiting Gauge Describes whether the container is currently in waiting state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_status_waiting_reason Gauge Describes the reason the container is currently in waiting state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;container-waiting-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_status_running Gauge Describes whether the container is currently in running state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_state_started Gauge Start time in unix timestamp for a pod container seconds <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_status_terminated Gauge Describes whether the container is currently in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_status_terminated_reason Gauge Describes the reason the container is currently in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;container-terminated-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_container_status_last_terminated_reason Gauge Describes the last reason the container was in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;last-terminated-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_container_status_last_terminated_exitcode Gauge Describes the exit code for the last container in terminated state. <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_container_status_ready Gauge Describes whether the containers readiness check succeeded <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_status_initialized_time Gauge Time when the pod is initialized. seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL kube_pod_status_ready_time Gauge Time when pod passed readiness probes. seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL kube_pod_status_container_ready_time Gauge Time when the container of the pod entered Ready state. seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL kube_pod_container_status_restarts_total Counter The number of container restarts per container <code>container</code>=&lt;container-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_container_resource_requests Gauge The number of requested request resource by a container. It is recommended to use the <code>kube_pod_resource_requests</code> metric exposed by kube-scheduler instead, as it is more precise. <code>cpu</code>=&lt;core&gt;  <code>memory</code>=&lt;bytes&gt; <code>resource</code>=&lt;resource-name&gt;  <code>unit</code>=&lt;resource-unit&gt;  <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>node</code>=&lt; node-name&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_container_resource_limits Gauge The number of requested limit resource by a container. It is recommended to use the <code>kube_pod_resource_limits</code> metric exposed by kube-scheduler instead, as it is more precise. <code>cpu</code>=&lt;core&gt;  <code>memory</code>=&lt;bytes&gt; <code>resource</code>=&lt;resource-name&gt;  <code>unit</code>=&lt;resource-unit&gt;  <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>node</code>=&lt; node-name&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_overhead_cpu_cores Gauge The pod overhead in regards to cpu cores associated with running a pod core <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_overhead_memory_bytes Gauge The pod overhead in regards to memory associated with running a pod bytes <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_runtimeclass_name_info Gauge The runtimeclass associated with the pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_created Gauge Unix creation timestamp seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_deletion_timestamp Gauge Unix deletion timestamp seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_restart_policy Gauge Describes the restart policy in use by this pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>type</code>=&lt;Always|Never|OnFailure&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_info Gauge Information about an init container in a pod <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>image</code>=&lt;image-name&gt;  <code>image_id</code>=&lt;image-id&gt;  <code>image_spec</code>=&lt;image-spec&gt;  <code>container_id</code>=&lt;containerid&gt;  <code>uid</code>=&lt;pod-uid&gt;  <code>restart_policy</code>=&lt;restart-policy&gt; STABLE - kube_pod_init_container_status_waiting Gauge Describes whether the init container is currently in waiting state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_status_waiting_reason Gauge Describes the reason the init container is currently in waiting state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;container-waiting-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_init_container_status_running Gauge Describes whether the init container is currently in running state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_status_terminated Gauge Describes whether the init container is currently in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_status_terminated_reason Gauge Describes the reason the init container is currently in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;container-terminated-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_init_container_status_last_terminated_reason Gauge Describes the last reason the init container was in terminated state <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;last-terminated-reason&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_init_container_status_ready Gauge Describes whether the init containers readiness check succeeded <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_status_restarts_total Counter The number of restarts for the init container integer <code>container</code>=&lt;container-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_init_container_resource_limits Gauge The number of CPU cores requested limit by an init container <code>cpu</code>=&lt;core&gt;  <code>memory</code>=&lt;bytes&gt; <code>resource</code>=&lt;resource-name&gt;  <code>unit</code>=&lt;resource-unit&gt;  <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>node</code>=&lt; node-name&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_init_container_resource_requests Gauge The number of CPU cores requested by an init container <code>cpu</code>=&lt;core&gt;  <code>memory</code>=&lt;bytes&gt; <code>resource</code>=&lt;resource-name&gt;  <code>unit</code>=&lt;resource-unit&gt;  <code>container</code>=&lt;container-name&gt;  <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>node</code>=&lt; node-name&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_spec_volumes_persistentvolumeclaims_info Gauge Information about persistentvolumeclaim volumes in a pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>volume</code>=&lt;volume-name&gt;   <code>persistentvolumeclaim</code>=&lt;persistentvolumeclaim-claimname&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_spec_volumes_persistentvolumeclaims_readonly Gauge Describes whether a persistentvolumeclaim is mounted read only bool <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;   <code>volume</code>=&lt;volume-name&gt;   <code>persistentvolumeclaim</code>=&lt;persistentvolumeclaim-claimname&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_status_reason Gauge The pod status reasons <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>reason</code>=&lt;Evicted|NodeAffinity|NodeLost|Shutdown|UnexpectedAdmissionError&gt;  <code>uid</code>=&lt;pod-uid&gt; EXPERIMENTAL - kube_pod_status_scheduled_time Gauge Unix timestamp when pod moved into scheduled status seconds <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_status_unschedulable Gauge Describes the unschedulable status for the pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt; STABLE - kube_pod_tolerations Gauge Information about the pod tolerations <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt;  <code>key</code>=&lt;toleration-key&gt;  <code>operator</code>=&lt;toleration-operator&gt;  <code>value</code>=&lt;toleration-value&gt;  <code>effect</code>=&lt;toleration-effect&gt; <code>toleration_seconds</code>=&lt;toleration-seconds&gt; EXPERIMENTAL - kube_pod_service_account Gauge The service account for a pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt;  <code>service_account</code>=&lt;service_account&gt; EXPERIMENTAL - kube_pod_scheduler Gauge The scheduler for a pod <code>pod</code>=&lt;pod-name&gt;  <code>namespace</code>=&lt;pod-namespace&gt;  <code>uid</code>=&lt;pod-uid&gt;  <code>name</code>=&lt;scheduler-name&gt; EXPERIMENTAL -","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#_1","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u83b7\u53d6pod\u5728 <code>Unknown</code>\u72b6\u6001 <pre><code>sum(kube_pod_status_phase{phase=\"Unknown\"}) by (namespace, pod) or (count(kube_pod_deletion_timestamp) by (namespace, pod) * sum(kube_pod_status_reason{reason=\"NodeLost\"}) by(namespace, pod)) &gt; 0\n</code></pre></li> <li>\u83b7\u53d6pod\u5728 <code>Terminating</code>\u72b6\u6001 <pre><code>count(kube_pod_deletion_timestamp) by (namespace, pod) * count(kube_pod_status_reason{reason=\"NodeLost\"} == 0) by (namespace, pod) &gt; 0\n</code></pre></li> </ul>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#deployment-metrics","title":"deployment-metrics","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#cadvisor","title":"cAdvisor","text":"<p>\u5b98\u7f51\uff1ahttps://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md#prometheus-container-metrics</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#k8s_1","title":"K8S\u76d1\u63a7\u8bed\u53e5","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#k8s_2","title":"k8s\u8d1f\u8f7d","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubepodcrashlooping","title":"KubePodCrashLooping","text":"<p><pre><code>rate(kube_pod_container_status_restarts_total{job=\"kube-state-metrics\"}[5m]) * 60 * 5 &gt; 0\n</code></pre> \u6216\u8005 <pre><code>changes(kube_pod_container_status_restarts_total[5m])&gt; 0\n</code></pre> \u62a5\u8b66\u4fe1\u606f</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/\u5bb9\u5668 {{ $labels.container}} \u6700\u8fd15\u5206\u949f\u91cd\u542f{{ printf \"%.2f\" $value }}\u6b21</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubepodnotready","title":"KubePodNotReady","text":"<p><pre><code>sum by (cluster,namespace, pod) (\n  max by(cluster,namespace, pod) (\n    kube_pod_status_phase{job=\"kube-state-metrics\", phase=~\"Pending|Unknown\"}\n  ) * on(cluster,namespace, pod) group_left(owner_kind) topk by(cluster,namespace, pod) (\n    1, max by(cluster,namespace, pod, owner_kind) (kube_pod_owner{owner_kind!=\"Job\"})\n  )\n) &gt; 0\n</code></pre> \u5728Kubernetes\u73af\u5883\u4e2d\u68c0\u67e5\u662f\u5426\u5b58\u5728\u5904\u4e8e\"Pending\"\u6216\"Unknown\"\u72b6\u6001\u7684Pod\uff0c\u4e14\u8fd9\u4e9bPod\u7684\u6240\u6709\u8005\uff08owner\uff09\u4e0d\u662f\"Job\"\u3002</p> <ul> <li>sum by (cluster, namespace, pod): \u9996\u5148\u5bf9\u67e5\u8be2\u7ed3\u679c\u8fdb\u884c\u805a\u5408\uff0c\u6309\u7167cluster\u3001namespace\u548cpod\u8fd9\u4e09\u4e2a\u6807\u7b7e\u8fdb\u884c\u5206\u7ec4\u3002</li> <li>max by(cluster, namespace, pod): \u5728\u5185\u90e8\uff0c\u5bf9\u4e8e\u6bcf\u4e2acluster\u3001namespace\u548cpod\u7684\u7ec4\u5408\uff0c\u627e\u5230\u6ee1\u8db3\u6761\u4ef6\u7684Pod\u4e2d\u6700\u5927\u7684\u503c\u3002</li> <li>\u8fd9\u91cc\u4f7f\u7528\u7684\u662fkube_pod_status_phase{job=\"kube-state-metrics\", phase=~\"Pending|Unknown\"}\u67e5\u8be2\uff0c\u5b83\u4f1a\u8fd4\u56de\u5904\u4e8e\"Pending\"\u6216\"Unknown\"\u72b6\u6001\u7684Pod\u3002</li> <li>on(cluster, namespace, pod) group_left(owner_kind): \u4f7f\u7528on\u5173\u952e\u5b57\u6307\u5b9a\u4e86\u9700\u8981\u4e0e\u524d\u9762\u7684\u7ed3\u679c\u8fdb\u884c\u5173\u8054\u7684\u6807\u7b7e\uff0c\u8fd9\u91cc\u662fcluster\u3001namespace\u548cpod\u3002</li> <li>group_left\u786e\u4fdd\u4fdd\u7559\u5de6\u4fa7\u67e5\u8be2\uff08\u5373\u524d\u9762\u7684\u67e5\u8be2\uff09\u4e2d\u7684\u6807\u7b7e\uff0c\u5e76\u4e0e\u53f3\u4fa7\u67e5\u8be2\uff08\u5373\u540e\u9762\u7684\u67e5\u8be2\uff09\u8fdb\u884c\u5173\u8054\u3002</li> <li>topk by(cluster, namespace, pod):\u5bf9\u4e8e\u6bcf\u4e2acluster\u3001namespace\u548cpod\u7684\u7ec4\u5408\uff0c\u627e\u5230\u6ee1\u8db3\u6761\u4ef6\u7684Pod\u7684\u6240\u6709\u8005\uff0c\u5e76\u53ea\u9009\u62e9\u4e00\u4e2a\u3002 topk\u51fd\u6570\u7528\u4e8e\u9009\u62e9\u6ee1\u8db3\u6761\u4ef6\u7684\u6700\u9876\u90e8\u7684\u8bb0\u5f55\u3002\u8fd9\u91cc\u9009\u62e9\u7684\u662f\u524d\u4e00\u4e2a\u67e5\u8be2\u4e2d\u7684Pod\u7684\u6240\u6709\u8005\u3002</li> <li>1, max by(cluster, namespace, pod, owner_kind) (kube_pod_owner{owner_kind!=\"Job\"}): \u8fd9\u662f\u4e00\u4e2a\u5b50\u67e5\u8be2\uff0c\u5b83\u67e5\u627e\u6ee1\u8db3\u6761\u4ef6\u7684Pod\u7684\u6240\u6709\u8005\uff0c\u5e76\u786e\u4fdd\u8fd9\u4e9b\u6240\u6709\u8005\u4e0d\u662f\"Job\"\u3002 \u4f7f\u7528max by\u786e\u4fdd\u5bf9\u4e8e\u6bcf\u4e2acluster\u3001namespace\u3001pod\u548cowner_kind\u7684\u7ec4\u5408\uff0c\u627e\u5230\u6700\u5927\u7684\u503c\uff08\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u53ea\u662f\u67e5\u627e\u4efb\u610f\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff09\u3002</li> <li><code>&gt; 0</code>: \u6700\u540e\uff0c\u4e3b\u67e5\u8be2\u786e\u4fdd\u7ed3\u679c\u5927\u4e8e0\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u627e\u5230\u4efb\u4f55\u6ee1\u8db3\u6761\u4ef6\u7684Pod\uff0c\u4e14\u5b83\u7684\u6240\u6709\u8005\u4e0d\u662f\"Job\"\uff0c\u5219\u7ed3\u679c\u4e3a\u771f\u3002 \u7efc\u4e0a\u6240\u8ff0\uff0c\u8fd9\u6bb5\u67e5\u8be2\u8bed\u53e5\u7528\u4e8e\u68c0\u67e5Kubernetes\u96c6\u7fa4\u4e2d\u662f\u5426\u5b58\u5728\u5904\u4e8e\"Pending\"\u6216\"Unknown\"\u72b6\u6001\u7684Pod\uff0c\u5e76\u4e14\u8fd9\u4e9bPod\u7684\u6240\u6709\u8005\u4e0d\u662f\"Job\"\u3002\u5982\u679c\u5b58\u5728\u8fd9\u6837\u7684Pod\uff0c\u67e5\u8be2\u7ed3\u679c\u5c06\u4e3a\u771f\u3002</li> </ul> <p>\u62a5\u8b66\u4fe1\u606f</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}\u5904\u4e8eNotReady\u72b6\u6001\u8d85\u8fc715\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubedeploymentgenerationmismatch","title":"KubeDeploymentGenerationMismatch","text":"<p>\u51fa\u73b0\u90e8\u7f72\u7248\u672c\u4e0d\u5339\u914d <pre><code>kube_deployment_status_observed_generation{job=\"kube-state-metrics\"}\n  !=\nkube_deployment_metadata_generation{job=\"kube-state-metrics\"}\n</code></pre> \u544a\u8b66\u4fe1\u606f</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/deployment {{ $labels.deployment}}\u90e8\u7f72\u7248\u672c\u4e0d\u7b26\u5408\u9884\u671f\uff0c\u8868\u793aDeployment\u53d8\u66f4\u6ca1\u6709\u751f\u6548</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubedeploymentreplicasmismatch","title":"KubeDeploymentReplicasMismatch","text":"<p>\u51fa\u73b0\u90e8\u7f72\u526f\u672c\u4e0d\u5339\u914d\u3002 <pre><code>(\n  kube_deployment_spec_replicas{job=\"kube-state-metrics\"}\n    !=\n  kube_deployment_status_replicas_available{job=\"kube-state-metrics\"}\n) and (\n  changes(kube_deployment_status_replicas_updated{job=\"kube-state-metrics\"}[5m])\n    ==\n  0\n)\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/deployment {{ $labels.deployment }} \u6ca1\u6709\u8fbe\u5230\u9884\u671f\u526f\u672c\u6570\u8d85\u8fc75\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubestatefulsetreplicasmismatch","title":"KubeStatefulSetReplicasMismatch","text":"<p>\u72b6\u6001\u96c6\u526f\u672c\u4e0d\u5339\u914d\u3002 <pre><code>(\n  kube_statefulset_status_replicas_ready{job=\"kube-state-metrics\"}\n    !=\n  kube_statefulset_status_replicas{job=\"kube-state-metrics\"}\n) and (\n  changes(kube_statefulset_status_replicas_updated{job=\"kube-state-metrics\"}[5m])\n    ==\n  0\n)\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset }} \u6ca1\u6709\u8fbe\u5230\u9884\u671f\u526f\u672c\u6570\u8d85\u8fc75\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubestatefulsetgenerationmismatch","title":"KubeStatefulSetGenerationMismatch","text":"<p>\u72b6\u6001\u96c6\u7248\u672c\u4e0d\u5339\u914d\u3002 <pre><code>kube_statefulset_status_observed_generation{job=\"kube-state-metrics\"}\n  !=\nkube_statefulset_metadata_generation{job=\"kube-state-metrics\"}\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset}} \u90e8\u7f72\u7248\u672c\u4e0d\u7b26\u5408\u9884\u671f\uff0c\u8868\u793astatefulset\u53d8\u66f4\u6ca1\u6709\u751f\u6548</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubestatefulsetupdatenotrolledout","title":"KubeStatefulSetUpdateNotRolledOut","text":"<p>\u72b6\u6001\u96c6\u66f4\u65b0\u672a\u9000\u51fa\u3002 <pre><code>(\n  max without (revision) (\n    kube_statefulset_status_current_revision{job=\"kube-state-metrics\"}\n      unless\n    kube_statefulset_status_update_revision{job=\"kube-state-metrics\"}\n  )\n    *\n  (\n    kube_statefulset_replicas{job=\"kube-state-metrics\"}\n      !=\n    kube_statefulset_status_replicas_updated{job=\"kube-state-metrics\"}\n  )\n)  and (\n  changes(kube_statefulset_status_replicas_updated{job=\"kube-state-metrics\"}[5m])\n    ==\n  0\n)\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/statefulset {{ $labels.statefulset }} \u90e8\u5206Pod\u672a\u66f4\u65b0</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubedaemonsetrolloutstuck","title":"KubeDaemonSetRolloutStuck","text":"<p>DaemonSet\u9000\u51fa\u56de\u9000\u3002 <pre><code>(\n  (\n    kube_daemonset_status_current_number_scheduled{job=\"kube-state-metrics\"}\n     !=\n    kube_daemonset_status_desired_number_scheduled{job=\"kube-state-metrics\"}\n  ) or (\n    kube_daemonset_status_number_misscheduled{job=\"kube-state-metrics\"}\n     !=\n    0\n  ) or (\n    kube_daemonset_updated_number_scheduled{job=\"kube-state-metrics\"}\n     !=\n    kube_daemonset_status_desired_number_scheduled{job=\"kube-state-metrics\"}\n  ) or (\n    kube_daemonset_status_number_available{job=\"kube-state-metrics\"}\n     !=\n    kube_daemonset_status_desired_number_scheduled{job=\"kube-state-metrics\"}\n  )\n) and (\n  changes(kube_daemonset_updated_number_scheduled{job=\"kube-state-metrics\"}[5m])\n    ==\n  0\n)\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset }} \u53d8\u66f4\u5361\u4e86\u8d85\u8fc75\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubecontainerwaiting","title":"KubeContainerWaiting","text":"<p>\u5bb9\u5668\u7b49\u5f85\u3002 <pre><code>sum by (namespace, pod, container,cluster) (kube_pod_container_status_waiting_reason{job=\"kube-state-metrics\"}) &gt; 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/pod {{ $labels.pod }}/container {{ $labels.container}} \u5904\u4e8eWaiting\u72b6\u6001\u8d85\u8fc710\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubedaemonsetnotscheduled","title":"KubeDaemonSetNotScheduled","text":"<p>DaemonSet\u65e0\u8ba1\u5212 <pre><code>kube_daemonset_status_desired_number_scheduled{job=\"kube-state-metrics\"}\n  -\nkube_daemonset_status_current_number_scheduled{job=\"kube-state-metrics\"} &gt; 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/ namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset}}  \u4e2d {{ $value }} \u4e2a pod \u6ca1\u6709\u88ab\u8c03\u5ea6</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubedaemonsetmisscheduled","title":"KubeDaemonSetMisScheduled","text":"<p>Daemon\u7f3a\u5931\u8ba1\u5212 <pre><code>kube_daemonset_status_number_misscheduled{job=\"kube-state-metrics\"} &gt; 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/daemonset {{ $labels.daemonset}} \u4e2d {{ $value }} \u4e2a pod \u9519\u8bef\u8c03\u5ea6\u5230node\u4e0a</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubejobcompletion","title":"KubeJobCompletion","text":"<p>\u4efb\u52a1\u5b8c\u6210 <pre><code>kube_job_spec_completions{job=\"kube-state-metrics\"} - kube_job_status_succeeded{job=\"kube-state-metrics\"}  &gt; 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/job {{ $labels.job_name }} \u4efb\u52a1\u5b8c\u6210</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubejobfailed","title":"KubeJobFailed","text":"<p>\u4efb\u52a1\u5931\u8d25 <pre><code>kube_job_status_failed{job=\"kube-state-metrics\"} &gt; 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/job {{ $labels.job_name }} \u6267\u884c\u5931\u8d25</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubehpareplicasmismatch","title":"KubeHpaReplicasMismatch","text":"<p>HPA\u526f\u672c\u4e0d\u5339\u914d <pre><code>(kube_hpa_status_desired_replicas{job=\"kube-state-metrics\"}\n  !=\nkube_hpa_status_current_replicas{job=\"kube-state-metrics\"})\n  and\nchanges(kube_hpa_status_current_replicas[10m]) == 0\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/HPA {{ $labels.hpa }} \u526f\u672c\u6570\u548c\u9884\u671f\u4e0d\u4e00\u81f4\u8d85\u8fc710\u5206\u949f</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubehpamaxedout","title":"KubeHpaMaxedOut","text":"<p>HPA\u526f\u672c\u8d85\u8fc7\u6700\u5927\u503c <pre><code>kube_hpa_status_current_replicas{job=\"kube-state-metrics\"}\n  ==\nkube_hpa_spec_max_replicas{job=\"kube-state-metrics\"}\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4 {{ $labels.cluster }}/namespace {{ $labels.namespace }}/HPA {{ $labels.hpa }} \u526f\u672c\u6570\u8fbe\u5230\u6700\u5927\u503c\u8d85\u8fc75m</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#k8s_3","title":"k8s\u8d44\u6e90","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubecpuovercommit","title":"KubeCPUOvercommit","text":"<p>CPU\u8fc7\u8f7d <pre><code>sum(kube_pod_container_resource_requests_cpu_cores) by (cluster) /sum(kube_node_status_allocatable_cpu_cores) by (cluster)  &gt;\n(count(kube_node_status_allocatable_cpu_cores) by (cluster) -1)   / count(kube_node_status_allocatable_cpu_cores) by (cluster) \n</code></pre></p> <p>\u65b0\u7248\u672c\u7684Kube_state_metric\u8bed\u53e5 <pre><code>sum(kube_pod_container_resource_requests{resource=\"cpu\"}) by (cluster)  \n  /\nsum(kube_node_status_allocatable{resource=\"cpu\"})\n by (cluster)  &gt;\n(count(kube_node_status_allocatable{resource=\"cpu\"}) by (cluster) -1)   / count(kube_node_status_allocatable{resource=\"cpu\"}) by (cluster) \n</code></pre></p> <p>\u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}\u5185Pod\u7533\u8bf7\u7684CPU\u8fc7\u8f7d\uff0c\u5f53\u524dCPU\u7533\u8bf7\u5360\u6bd4{{ $value | humanizePercentage }}</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubememoryovercommit","title":"KubeMemoryOvercommit","text":"<p>\u5185\u5b58\u8fc7\u8f7d <pre><code>sum(namespace:kube_pod_container_resource_requests_memory_bytes:sum{}) by (cluster)  \n  /\nsum(kube_node_status_allocatable_memory_bytes) by (cluster)  \n  &gt;\n(count(kube_node_status_allocatable_memory_bytes) by (cluster)-1)  \n  /\ncount(kube_node_status_allocatable_memory_bytes) by (cluster)  \n</code></pre></p> <p>\u65b0\u7248\u672c\u7684Kube_state_metric\u8bed\u53e5 sum(kube_pod_container_resource_requests{resource=\"memory\"}) by (cluster)   / sum(kube_node_status_allocatable{resource=\"memory\"}) by (cluster)  </p> <p>(count(kube_node_status_allocatable{resource=\"memory\"}) by (cluster)-1)   / count(kube_node_status_allocatable{resource=\"memory\"}) by (cluster)  </p> <p>\u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}\u5185Pod\u7533\u8bf7\u7684\u5185\u5b58\u8fc7\u8f7d\uff0c\u5f53\u524dCPU\u7533\u8bf7\u5360\u6bd4{{ $value | humanizePercentage }}</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubecpuquotaovercommit","title":"KubeCPUQuotaOvercommit","text":"<p>CPU\u989d\u5ea6\u8fc7\u8f7d\uff08kube_resourcequota\u4e0d\u5b58\u5728\uff0c\u4eceresourcequota-metrics\u4e2d \u91c7\u96c6\uff09 <pre><code>sum(kube_resourcequota{job=\"kube-state-metrics\", type=\"hard\", resource=\"cpu\"})  by (cluster)  \n  /\nsum(kube_node_status_allocatable_cpu_cores) by (cluster)  \n  &gt; 1.5\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}CPU Quota\u8fc7\u8f7d\uff0c\u5df2\u7ecf\u8d85\u8fc7\u53ef\u5206\u914dCPU\u8d44\u6e90\u7684{{ $value }}\u500d</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubememoryquotaovercommit","title":"KubeMemoryQuotaOvercommit","text":"<p>\u5185\u5b58\u989d\u5ea6\u8fc7\u8f7d\uff08kube_resourcequota\u4e0d\u5b58\u5728\uff0c\u4eceresourcequota-metrics\u4e2d \u91c7\u96c6\uff09 <pre><code>sum(kube_resourcequota{job=\"kube-state-metrics\", type=\"hard\", resource=\"memory\"}) by (cluster)  \n  /\nsum(kube_node_status_allocatable_memory_bytes{job=\"node-exporter\"}) by (cluster)   \n  &gt; 1.5\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}\u5185\u5b58\u914d\u989d\u8fc7\u8f7d\uff0c\u5df2\u7ecf\u8d85\u8fc7\u53ef\u5206\u914d\u5185\u5b58\u8d44\u6e90\u7684{{ $value }}\u500d</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubequotaalmostfull","title":"KubeQuotaAlmostFull","text":"<p>\u914d\u989d\u5feb\u8d85\u8fc7\u9650\u5236\u4e86 <pre><code>kube_resourcequota{job=\"kube-state-metrics\", type=\"used\"}\n  / ignoring(instance, job, type)\n(kube_resourcequota{job=\"kube-state-metrics\", type=\"hard\"} &gt; 0)\n  &gt; 0.7 \n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}\u4e2d\u8d44\u6e90{{ $labels.resource }}\u4f7f\u7528\u7387\u8d85\u8fc7{{ $value | humanizePercentage }}</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#kubequotaexceeded","title":"KubeQuotaExceeded","text":"<p>\u914d\u989d\u8d85\u9650\u5236\u4e86 <pre><code>kube_resourcequota{job=\"kube-state-metrics\", type=\"used\"}\n  / ignoring(instance, job, type)\n(kube_resourcequota{job=\"kube-state-metrics\", type=\"hard\"} &gt; 0)\n  &gt; 1\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}\u4e2d\u8d44\u6e90{{ $labels.resource }}\u4f7f\u7528\u7387\u8d85\u8fc7{{ $value | humanizePercentage }}</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#runningpodnamespacepodnode","title":"\u67e5\u8be2\u5904\u5728RUNNING\u72b6\u6001\u7684pod\u7684\u5185\u5b58\u8bf7\u6c42\u91cf\u603b\u548c\uff0c\u6309\u7167namespace\u3001pod\u548cnode\u8fdb\u884c\u5206\u7ec4","text":"<p><pre><code>sum(kube_pod_container_resource_requests{resource=\"memory\"}) by (namespace, pod, node)\n  * on (namespace, pod) group_left() (sum(kube_pod_status_phase{phase=\"Running\"}) by (pod, namespace) == 1)\n</code></pre> - sum(kube_pod_container_resource_requests{resource=\"memory\"}) by (namespace, pod, node): \u8fd9\u90e8\u5206\u67e5\u8be2\u662f\u5bf9\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\uff08namespace\uff09\u3001Pod\u548c\u8282\u70b9\uff08node\uff09\u7684\u5185\u5b58\u8bf7\u6c42\u8fdb\u884c\u6c42\u548c\u3002 - kube_pod_container_resource_requests{resource=\"memory\"}\u8fd9\u90e8\u5206\u662f\u4ecekube-state-metrics\u83b7\u53d6\u7684\uff0c\u5b83\u4f1a\u8fd4\u56de\u6bcf\u4e2aPod\u5bb9\u5668\u7684\u5185\u5b58\u8bf7\u6c42\u3002 - on (namespace, pod) group_left(): \u4f7f\u7528on\u5173\u952e\u5b57\u6307\u5b9a\u4e86\u9700\u8981\u4e0e\u524d\u9762\u7684\u7ed3\u679c\u8fdb\u884c\u5173\u8054\u7684\u6807\u7b7e\uff0c\u8fd9\u91cc\u662fnamespace\u548cpod\u3002 group_left()\u786e\u4fdd\u4fdd\u7559\u5de6\u4fa7\u67e5\u8be2\u4e2d\u7684\u6807\u7b7e\uff0c\u5e76\u4e0e\u53f3\u4fa7\u67e5\u8be2\u8fdb\u884c\u5173\u8054\uff0c\u4f46\u5728\u6b64\u4f8b\u4e2d\uff0c\u53f3\u4fa7\u67e5\u8be2\u4e0d\u9700\u8981\u989d\u5916\u7684\u6807\u7b7e\u3002 - (sum(kube_pod_status_phase{phase=\"Running\"}) by (pod, namespace) == 1): \u8fd9\u662f\u4e00\u4e2a\u5b50\u67e5\u8be2\uff0c\u5b83\u68c0\u67e5\u6bcf\u4e2aPod\u662f\u5426\u5904\u4e8e\"Running\"\u72b6\u6001\u3002 \u4f7f\u7528sum\u5bf9\u6bcf\u4e2aPod\u548c\u547d\u540d\u7a7a\u95f4\u7684\"Running\"\u72b6\u6001\u8fdb\u884c\u6c42\u548c\u3002\u7531\u4e8ePod\u7684\u72b6\u6001\u53ea\u80fd\u662f0\u62161\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6c42\u548c\u7684\u7ed3\u679c\u8981\u4e48\u662f0\uff08\u8868\u793a\u6ca1\u6709Pod\u5904\u4e8e\"Running\"\u72b6\u6001\uff09\uff0c\u8981\u4e48\u662f1\uff08\u8868\u793a\u6709\u4e00\u4e2aPod\u5904\u4e8e\"Running\"\u72b6\u6001\uff09\u3002 - == 1\u786e\u4fdd\u53ea\u9009\u62e9\u5904\u4e8e\"Running\"\u72b6\u6001\u7684Pod\u3002 - \u6700\u7ec8\uff0c\u4e24\u4e2a\u67e5\u8be2\u7ed3\u679c\u7684\u4e58\u79ef\uff1a\u8fd9\u610f\u5473\u7740\u6211\u4eec\u5e0c\u671b\u67e5\u627e\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\u7684Pod\uff1a\u4e00\u662f\u5b83\u4eec\u8bf7\u6c42\u4e86\u5185\u5b58\u8d44\u6e90\uff0c\u4e8c\u662f\u5b83\u4eec\u5904\u4e8e\"Running\"\u72b6\u6001\u3002</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#cadvisor_1","title":"CAdvisor","text":"<p>\u5b98\u7f51\u6587\u6863\uff1ahttps://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#prometheus-container-metrics","title":"Prometheus container metrics","text":"<p>The table below lists the Prometheus container metrics exposed by cAdvisor (in alphabetical order by metric name) and corresponding <code>-disable_metrics</code> / <code>-enable_metrics</code> option parameter:</p> Metric name Type Description Unit (where applicable) option parameter additional build flag <code>container_blkio_device_usage_total</code> Counter Blkio device bytes usage bytes diskIO <code>container_cpu_cfs_periods_total</code> Counter Number of elapsed enforcement period intervals cpu <code>container_cpu_cfs_throttled_periods_total</code> Counter Number of throttled period intervals cpu <code>container_cpu_cfs_throttled_seconds_total</code> Counter Total time duration the container has been throttled seconds cpu <code>container_cpu_load_average_10s</code> Gauge Value of container cpu load average over the last 10 seconds cpuLoad <code>container_cpu_schedstat_run_periods_total</code> Counter Number of times processes of the cgroup have run on the cpu sched <code>container_cpu_schedstat_runqueue_seconds_total</code> Counter Time duration processes of the container have been waiting on a runqueue seconds sched <code>container_cpu_schedstat_run_seconds_total</code> Counter Time duration the processes of the container have run on the CPU seconds sched <code>container_cpu_system_seconds_total</code> Counter Cumulative system cpu time consumed seconds cpu <code>container_cpu_usage_seconds_total</code> Counter Cumulative cpu time consumed seconds cpu <code>container_cpu_user_seconds_total</code> Counter Cumulative user cpu time consumed seconds cpu <code>container_file_descriptors</code> Gauge Number of open file descriptors for the container process <code>container_fs_inodes_free</code> Gauge Number of available Inodes disk <code>container_fs_inodes_total</code> Gauge Total number of Inodes disk <code>container_fs_io_current</code> Gauge Number of I/Os currently in progress diskIO <code>container_fs_io_time_seconds_total</code> Counter Cumulative count of seconds spent doing I/Os seconds diskIO <code>container_fs_io_time_weighted_seconds_total</code> Counter Cumulative weighted I/O time seconds diskIO <code>container_fs_limit_bytes</code> Gauge Number of bytes that can be consumed by the container on this filesystem bytes disk <code>container_fs_reads_bytes_total</code> Counter Cumulative count of bytes read bytes diskIO <code>container_fs_read_seconds_total</code> Counter Cumulative count of seconds spent reading diskIO <code>container_fs_reads_merged_total</code> Counter Cumulative count of reads merged diskIO <code>container_fs_reads_total</code> Counter Cumulative count of reads completed diskIO <code>container_fs_sector_reads_total</code> Counter Cumulative count of sector reads completed diskIO <code>container_fs_sector_writes_total</code> Counter Cumulative count of sector writes completed diskIO <code>container_fs_usage_bytes</code> Gauge Number of bytes that are consumed by the container on this filesystem bytes disk <code>container_fs_writes_bytes_total</code> Counter Cumulative count of bytes written bytes diskIO <code>container_fs_write_seconds_total</code> Counter Cumulative count of seconds spent writing seconds diskIO <code>container_fs_writes_merged_total</code> Counter Cumulative count of writes merged diskIO <code>container_fs_writes_total</code> Counter Cumulative count of writes completed diskIO <code>container_hugetlb_failcnt</code> Counter Number of hugepage usage hits limits hugetlb <code>container_hugetlb_max_usage_bytes</code> Gauge Maximum hugepage usages recorded bytes hugetlb <code>container_hugetlb_usage_bytes</code> Gauge Current hugepage usage bytes hugetlb <code>container_last_seen</code> Gauge Last time a container was seen by the exporter timestamp - <code>container_llc_occupancy_bytes</code> Gauge Last level cache usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM). bytes resctrl <code>container_memory_bandwidth_bytes</code> Gauge Total memory bandwidth usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM). bytes resctrl <code>container_memory_bandwidth_local_bytes</code> Gauge Local memory bandwidth usage statistics for container counted with RDT Memory Bandwidth Monitoring (MBM). bytes resctrl <code>container_memory_cache</code> Gauge Total page cache memory bytes memory <code>container_memory_failcnt</code> Counter Number of memory usage hits limits memory <code>container_memory_failures_total</code> Counter Cumulative count of memory allocation failures memory <code>container_memory_mapped_file</code> Gauge Size of memory mapped files bytes memory <code>container_memory_max_usage_bytes</code> Gauge Maximum memory usage recorded bytes memory <code>container_memory_migrate</code> Gauge Memory migrate status cpuset <code>container_memory_numa_pages</code> Gauge Number of used pages per NUMA node memory_numa <code>container_memory_rss</code> Gauge Size of RSS bytes memory <code>container_memory_swap</code> Gauge Container swap usage bytes memory <code>container_memory_usage_bytes</code> Gauge Current memory usage, including all memory regardless of when it was accessed bytes memory <code>container_memory_working_set_bytes</code> Gauge Current working set bytes memory <code>container_network_advance_tcp_stats_total</code> Gauge advanced tcp connections statistic for container advtcp <code>container_network_receive_bytes_total</code> Counter Cumulative count of bytes received bytes network <code>container_network_receive_errors_total</code> Counter Cumulative count of errors encountered while receiving network <code>container_network_receive_packets_dropped_total</code> Counter Cumulative count of packets dropped while receiving network <code>container_network_receive_packets_total</code> Counter Cumulative count of packets received network <code>container_network_tcp6_usage_total</code> Gauge tcp6 connection usage statistic for container tcp <code>container_network_tcp_usage_total</code> Gauge tcp connection usage statistic for container tcp <code>container_network_transmit_bytes_total</code> Counter Cumulative count of bytes transmitted bytes network <code>container_network_transmit_errors_total</code> Counter Cumulative count of errors encountered while transmitting network <code>container_network_transmit_packets_dropped_total</code> Counter Cumulative count of packets dropped while transmitting network <code>container_network_transmit_packets_total</code> Counter Cumulative count of packets transmitted network <code>container_network_udp6_usage_total</code> Gauge udp6 connection usage statistic for container udp <code>container_network_udp_usage_total</code> Gauge udp connection usage statistic for container udp <code>container_oom_events_total</code> Counter Count of out of memory events observed for the container oom_event <code>container_perf_events_scaling_ratio</code> Gauge Scaling ratio for perf event counter (event can be identified by <code>event</code> label and <code>cpu</code> indicates the core for which event was measured). See perf event configuration. perf_event libpfm <code>container_perf_events_total</code> Counter Scaled counter of perf core event (event can be identified by <code>event</code> label and <code>cpu</code> indicates the core for which event was measured). See perf event configuration. perf_event libpfm <code>container_perf_uncore_events_scaling_ratio</code> Gauge Scaling ratio for perf uncore event counter (event can be identified by <code>event</code> label, <code>pmu</code> and <code>socket</code> lables indicate the PMU and the CPU socket for which event was measured). See perf event configuration. Metric exists only for main cgroup (id=\"/\"). perf_event libpfm <code>container_perf_uncore_events_total</code> Counter Scaled counter of perf uncore event (event can be identified by <code>event</code> label, <code>pmu</code> and <code>socket</code> lables indicate the PMU and the CPU socket for which event was measured). See perf event configuration). Metric exists only for main cgroup (id=\"/\"). perf_event libpfm <code>container_processes</code> Gauge Number of processes running inside the container process <code>container_referenced_bytes</code> Gauge Container referenced bytes during last measurements cycle based on Referenced field in /proc/smaps file, with /proc/PIDs/clear_refs set to 1 after defined number of cycles configured through <code>referenced_reset_interval</code> cAdvisor parameter.Warning: this is intrusive collection because can influence kernel page reclaim policy and add latency. Refer to https://github.com/brendangregg/wss#wsspl-referenced-page-flag for more details. bytes referenced_memory <code>container_sockets</code> Gauge Number of open sockets for the container process <code>container_spec_cpu_period</code> Gauge CPU period of the container - <code>container_spec_cpu_quota</code> Gauge CPU quota of the container - <code>container_spec_cpu_shares</code> Gauge CPU share of the container - <code>container_spec_memory_limit_bytes</code> Gauge Memory limit for the container bytes - <code>container_spec_memory_reservation_limit_bytes</code> Gauge Memory reservation limit for the container bytes <code>container_spec_memory_swap_limit_bytes</code> Gauge Memory swap limit for the container bytes <code>container_start_time_seconds</code> Gauge Start time of the container since unix epoch seconds <code>container_tasks_state</code> Gauge Number of tasks in given state (<code>sleeping</code>, <code>running</code>, <code>stopped</code>, <code>uninterruptible</code>, or <code>ioawaiting</code>) cpuLoad <code>container_threads</code> Gauge Number of threads running inside the container process <code>container_threads_max</code> Gauge Maximum number of threads allowed inside the container process <code>container_ulimits_soft</code> Gauge Soft ulimit values for the container root process. Unlimited if -1, except priority and nice process","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#hardware-metrics","title":"hardware metrics","text":"<p>The table below lists the Prometheus hardware metrics exposed by cAdvisor (in alphabetical order by metric name) and corresponding <code>-disable_metrics</code> / <code>-enable_metrics</code> option parameter:</p> Metric name Type Description Unit (where applicable) option parameter addional build flag <code>machine_cpu_cache_capacity_bytes</code> Gauge Cache size in bytes assigned to NUMA node and CPU core bytes cpu_topology <code>machine_cpu_cores</code> Gauge Number of logical CPU cores <code>machine_cpu_physical_cores</code> Gauge Number of physical CPU cores <code>machine_cpu_sockets</code> Gauge Number of CPU sockets <code>machine_dimm_capacity_bytes</code> Gauge Total RAM DIMM capacity (all types memory modules) value labeled by dimm type,information is retrieved from sysfs edac per-DIMM API (/sys/devices/system/edac/mc/) introduced in kernel 3.6 bytes <code>machine_dimm_count</code> Gauge Number of RAM DIMM (all types memory modules) value labeled by dimm type,information is retrieved from sysfs edac per-DIMM API (/sys/devices/system/edac/mc/) introduced in kernel 3.6 <code>machine_memory_bytes</code> Gauge Amount of memory installed on the machine bytes <code>machine_swap_bytes</code> Gauge Amount of swap memory available on the machine bytes <code>machine_node_distance</code> Gauge Distance between NUMA node and target NUMA node cpu_topology <code>machine_node_hugepages_count</code> Gauge Numer of hugepages assigned to NUMA node cpu_topology <code>machine_node_memory_capacity_bytes</code> Gauge Amount of memory assigned to NUMA node bytes cpu_topology <code>machine_nvm_avg_power_budget_watts</code> Gauge NVM power budget watts libipmctl <code>machine_nvm_capacity</code> Gauge NVM capacity value labeled by NVM mode (memory mode or app direct mode) bytes libipmctl <code>machine_thread_siblings_count</code> Gauge Number of CPU thread siblings cpu_topology","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#_2","title":"\u5e38\u7528\u89c4\u5219","text":"","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#podcpulimitrate","title":"PodCPULimitRate","text":"<p>pod cpu\u4f7f\u7528\u5360limit\u7684\u767e\u5206\u6bd4 <pre><code>sum(rate(container_cpu_usage_seconds_total{job=\"cadvisor\", image!=\"\", container!=\"POD\"}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_limits_cpu_cores&gt;0) by (cluster, namespace, pod, container) &gt; 0.6\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}\u7684CPU\u4f7f\u7528\u7387(\u5360limit)\u8fbe{{ $value | humanizePercentage }}.</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#podcpurequestrate","title":"PodCPURequestRate","text":"<p>pod cpu\u4f7f\u7528\u5360request\u7684\u767e\u5206\u6bd4 <pre><code>sum(rate(container_cpu_usage_seconds_total{job=\"cadvisor\", image!=\"\", container!=\"POD\"}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_requests_cpu_cores&gt;0) by (cluster, namespace, pod, container) &gt; 0.8\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}\u7684CPU\u4f7f\u7528\u7387(\u5360request)\u8fbe{{ $value | humanizePercentage }}.</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#podmemorylimitrate","title":"PodMemoryLimitRate","text":"<p>pod \u5185\u5b58\u4f7f\u7528\u5360limit\u7684\u767e\u5206\u6bd4 <pre><code>sum(rate(container_memory_working_set_bytes{job=\"cadvisor\", image!=\"\", container!=\"POD\"}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_limits_memory_bytes&gt;0) by (cluster, namespace, pod, container) &gt; 0.8\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container {{ $labels.container }}\u7684\u5185\u5b58\u4f7f\u7528\u7387(\u5360limit)\u8fbe{{ $value | humanizePercentage }}.</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#podmemoryrequestrate","title":"PodMemoryRequestRate","text":"<p>pod \u5185\u5b58\u4f7f\u7528\u5360request\u7684\u767e\u5206\u6bd4 <pre><code>sum(rate(container_memory_working_set_bytes{job=\"cadvisor\", image!=\"\", container!=\"POD\"}[1m])) by (cluster, namespace, pod, container) / sum(kube_pod_container_resource_requests_memory_bytes&gt;0) by (cluster, namespace, pod, container) &gt; 0.8\n</code></pre> \u544a\u8b66\u5185\u5bb9</p> <p>\u96c6\u7fa4{{ $labels.cluster }}/namespace {{ $labels.namespace }}/Pod {{ $labels.pod }}/container{{ $labels.container }}\u7684\u5185\u5b58\u4f7f\u7528\u7387(\u5360request)\u8fbe{{ $value | humanizePercentage }}.</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/k8s-metrics/#_3","title":"\u53c2\u8003","text":"<p>kubenetes runbook: https://runbooks.prometheus-operator.dev/</p>","tags":["metrics","kube-state-metrics","cadvisor"]},{"location":"monitoring/monitoring/","title":"\u76d1\u63a7\u6982\u89c8","text":"<p>\u4ece\u7a0b\u5e8f\u8bbe\u8ba1\u4e0a\u6765\u770b\uff0c\u76d1\u63a7\u53ef\u5206\u4e3a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u76d1\u63a7\uff08APM\uff09</li> <li>\u4e2d\u95f4\u4ef6\u76d1\u63a7</li> <li>\u7c7b\u578b<ul> <li>\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0cRabbitMQ,Kafka</li> <li>Web\u670d\u52a1\u4e2d\u95f4\u4ef6\uff0cTomcat,Jetty</li> <li>\u7f13\u5b58\u4e2d\u95f4\u4ef6\uff0cRedis,Memcached</li> <li>\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\uff0cMysql,PostgreSQL</li> </ul> </li> <li>\u76d1\u63a7\u65b9\u5f0f<ul> <li>\u4e0d\u540c\u4e2d\u95f4\u4ef6\u76d1\u63a7\u65b9\u5f0f\u5e76\u4e0d\u76f8\u540c</li> <li>\u4e00\u822c\u91c7\u7528agent</li> <li>\u5bf9\u4e8ePrometheus\uff0c\u6bcf\u79cd\u90fd\u6709\u4e00\u79cd\u5bf9\u5e94\u7684exporter</li> </ul> </li> <li>\u57fa\u7840\u8d44\u6e90\u76d1\u63a7</li> <li>\u7f51\u7edc\u76d1\u63a7\u2014\u2014\u89e3\u51b3\u65b9\u6848\uff1a\u5929\u65e6\u3001nCompass\uff0cSolarWinds, Nagios\uff08\u5df2\u5f00\u6e90\uff09<ul> <li>\u6570\u636e\u4e2d\u5fc3\u5185 \u7f51\u7edc\u6d41\u91cf</li> <li>\u7f51\u7edc\u62d3\u6251\u53d1\u73b0\u53ca\u7f51\u7edc\u8bbe\u5907<ul> <li>\u5bf9\u6570\u636e\u4e2d\u5fc3\u5185\u7684\u591a\u79cd\u7f51\u7edc\u8bbe\u5907\u8fdb\u884c\u76d1\u63a7\uff0c\u8def\u7531\u5668\uff0c\u9632\u706b\u5899\uff0c\u4ea4\u6362\u673a\u7b49\u786c\u4ef6</li> <li>\u7f51\u7edc\u8bbe\u5907<ul> <li>\u6d41\u91cf\u955c\u50cf</li> <li>\u914d\u7f6e\u4ea4\u6362\u673a\u4e0a\u7684\u955c\u50cf\u7aef\u53e3</li> <li>\u865a\u62df\u8bbe\u5907\u2014\u2014tcpdump\u7b49\u5de5\u5177\u83b7\u53d6\u7f51\u7edc\u6570\u636e\u5305\uff0c\u6839\u636e\u6e90\u548c\u76ee\u7684IP\u6c47\u805a\u7f51\u7edc\u62d3\u6251\u7ed3\u6784</li> <li>\u901a\u8fc7SNMP\uff08Simple Network Management Protocol \u7b80\u5355\u7f51\u7edc\u7ba1\u7406\u534f\u8bae\uff09\u7b49\u534f\u8bae\u6536\u96c6\u6570\u636e</li> </ul> </li> </ul> </li> <li>\u7f51\u7edc\u6027\u80fd\u76d1\u63a7\uff08Network Performance Monitor, NPM\uff09<ul> <li>\u7f51\u7edc\u68c0\u6d4b</li> <li>\u7f51\u7edc\u5b9e\u65f6\u6d41\u91cf\u76d1\u63a7\uff08\u5ef6\u8fdf\uff0c\u8bbf\u95ee\u91cf\uff0c\u6210\u529f\u7387\uff09</li> <li>\u5386\u53f2\u6570\u636e\u7edf\u8ba1\u3001\u6c47\u603b\u3001\u6570\u636e\u5206\u6790</li> </ul> </li> <li>\u7f51\u7edc\u653b\u51fb\u63a2\u6d4b<ul> <li>\u901a\u8fc7\u5206\u6790\u5f02\u5e38\u6d41\u91cf\u6765\u786e\u5b9a\u7f51\u7edc\u653b\u51fb\u884c\u4e3a\uff0c\u5982DDos\u653b\u51fb</li> </ul> </li> </ul> </li> <li>\u5b58\u50a8<ul> <li>\u4e91\u5b58\u50a8</li> <li>\u5206\u5e03\u5f0f\u5b58\u50a8</li> </ul> </li> <li>\u670d\u52a1\u5668<ul> <li>\u7c7b\u578b<ul> <li>CPU</li> <li>\u5185\u5b58</li> <li>\u7f51\u7edc</li> <li>\u5b58\u50a8</li> </ul> </li> <li>\u5de5\u5177<ul> <li>Zabbix</li> <li>Open-Falcon</li> <li>Prometheus</li> </ul> </li> </ul> </li> <li>\u65e5\u5fd7\u76d1\u63a7</li> <li>Fluented(\u6536\u96c6) -&gt; Kafaka\uff08\u6570\u636e\u6574\u6d41\u5408\u5e76\uff09 -&gt; Logstash\uff08\u65e5\u5fd7\u6574\u7406\uff09 -&gt; Elasticsearch\uff08\u65e5\u5fd7\u5b58\u50a8\u548c\u68c0\u7d22\uff09 -&gt; Kibana\uff08\u65e5\u5fd7\u67e5\u8be2\uff09</li> </ul> <p></p> <p>linux\u4f7f\u7528\u4e0b\u56fe\uff08https://www.brendangregg.com/Perf/linux_perf_tools_full.png\uff09\u4e2d\u7684\u5404\u79cd\u6027\u80fd\u68c0\u6d4b\u5de5\u5177\u6765\u67e5\u770b\u7cfb\u7edf\u4e2d\u7684\u5404\u4e2a\u65b9\u9762\u7684\u6027\u80fd\u6307\u6807\u3002 </p>"},{"location":"monitoring/monitoring/#_2","title":"\u76d1\u63a7\u603b\u4f53\u67b6\u6784","text":"<ol> <li>\u6570\u636e\u91c7\u96c6\uff01\uff01</li> </ol> <p>\u4e3b\u52a8\u3001\u88ab\u52a8\u3001\u4e24\u79cd\u90fd\u6709</p> <ol> <li>\u6570\u636e\u4f20\u8f93</li> <li>socket</li> <li>http\u4f20\u8f93</li> <li>\u6570\u636e\u5b58\u50a8</li> </ol> <p>\u5b58\u5728Mysql\u4e2d\uff0c\u8fd8\u6709\u7684\u5b58\u5728MongoDB\uff0cOpenTSDB\uff0cInfluxDB\u7b49\u65f6\u5e8f\u6570\u636e\u5e93\u4e2d </p>"},{"location":"monitoring/monitoring/#_3","title":"\u6307\u6807\u91c7\u96c6\u5b50\u7cfb\u7edf","text":"<p>\u4e3b\u8981\u8d1f\u8d23\uff0c\u4fe1\u606f\u91c7\u96c6\u3001\u8fc7\u6ee4\u3001\u6c47\u603b\u548c\u5b58\u50a8</p>"},{"location":"monitoring/monitoring/#_4","title":"\u6307\u6807\u91c7\u96c6","text":""},{"location":"monitoring/monitoring/#_5","title":"\u901a\u8fc7\u5ba2\u6237\u7aef\u91c7\u96c6","text":"<p>\u901a\u8fc7\u6807\u51c6\u534f\u8bae\uff1aSNMP\uff0cJMX\uff0cIPMIprom\u901a\u8fc7\u5ba2\u6237\u7aefexporter\u91c7\u96c6\u3002exporter\u91c7\u96c6\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u67e5\u5904\u7406\uff0c\u7f13\u5b58\uff0c\u8d85\u65f6\u91cd\u8bd5\u7b49\u3002\u52a3\u52bf</p> <ul> <li>\u9700\u8981\u4e00\u5b9a\u7684\u5f00\u53d1\u5de5\u4f5c</li> <li>\u4fb5\u5165\u5f0f\u5b89\u88c5\u5ba2\u6237\u7aef\u5b58\u5728\u5b89\u5168\u548c\u6027\u80fd\u98ce\u9669</li> </ul>"},{"location":"monitoring/monitoring/#snmpjmxipmi","title":"\u901a\u8fc7\u6807\u51c6\u534f\u8bae\uff1aSNMP\uff0cJMX\uff0cIPMI","text":"<p>java\u5e94\u7528\u2014\u2014JMX</p>"},{"location":"monitoring/monitoring/#_6","title":"\u6570\u636e\u4f20\u8f93\u548c\u8fc7\u6ee4","text":"<p>\u91c7\u96c6\u6570\u636e\u4f20\u8f93\u5230\u6570\u636e\u5b58\u50a8\u8282\u70b9\u2014\u2014HTTP,socket\u8fde\u63a5\u8fdb\u884c\u70b9\u5bf9\u70b9\u4f20\u8f93\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7RabbitMQ\u548cKafka\u4e2d\u95f4\u4ef6\u8fdb\u884c\u4f20\u8f93</p>"},{"location":"monitoring/monitoring/#_7","title":"\u6570\u636e\u5b58\u50a8","text":"<p>\u65f6\u5e8f\u6570\u636e\u5e93\uff08TSDB\uff09\u7684\u7279\u70b9</p> <ul> <li>\u4e00\u6b21\u5199\u5165\u591a\u6b21\u8bfb\u53d6</li> <li>\u6570\u636e\u6d41\u6301\u7eed\u5e73\u7a33\uff0c\u6570\u636e\u91cf\u548c\u91c7\u96c6\u70b9\u7684\u6570\u636e\u5448\u6b63\u6bd4</li> <li>\u67e5\u8be2\u65b9\u5f0f\u4ee5\u65f6\u95f4\u4e3a\u7ef4\u5ea6\uff0c\u6570\u636e\u67e5\u8be2\u901a\u5e38\u6307\u5b9a\u4e00\u6bb5\u65f6\u95f4\uff0c\u5e76\u4e14\u70ed\u6570\u636e\u901a\u5e38\u662f\u6700\u65b0\u91c7\u96c6\u7684\u6570\u636e</li> <li>\u5b58\u50a8\u5bb9\u91cf\u5927\uff0c\u6570\u636e\u53ea\u8bfb\u53ca\u6570\u636e\u538b\u7f29\u6bd4\u5f88\u9ad8</li> <li>\u9ad8\u541e\u5410\u91cf\uff0c\u9ad8\u5e76\u53d1</li> </ul>"},{"location":"monitoring/monitoring/#_8","title":"\u6570\u636e\u5904\u7406\u5b50\u7cfb\u7edf","text":"<p>\u4e3b\u8981\u8d1f\u8d23\u6570\u636e\u5206\u6790\u3001\u5c55\u73b0\u3001\u9884\u8b66\u3001\u544a\u8b66\u52a8\u4f5c\u89e6\u53d1\u548c\u544a\u8b66\u7b49\u3002</p>"},{"location":"monitoring/monitoring/#_9","title":"\u6570\u636e\u67e5\u8be2","text":""},{"location":"monitoring/monitoring/#_10","title":"\u6570\u636e\u5206\u6790","text":""},{"location":"monitoring/monitoring/#_11","title":"\u6027\u80fd\u5206\u6790","text":"<p>\u67d0\u5e94\u7528\u7279\u5b9a\u65f6\u95f4\u6bb5\u5185\u7684\u8d44\u6e90\u6d88\u8017\u60c5\u51b5</p>"},{"location":"monitoring/monitoring/#_12","title":"\u5173\u8054\u5206\u6790","text":"<p>\u627e\u51fa\u6570\u636e\u4e4b\u95f4\u7684\u5173\u8054</p> <ul> <li>\u7f51\u7edc\u76d1\u63a7\u4e2d\uff0c\u6e90IP\u548c\u76ee\u7684IP\u5730\u5740\u5173\u8054\uff0c\u6784\u5efa\u7f51\u7edc\u8fde\u63a5\u62d3\u6251</li> <li>APM\u76d1\u63a7\u4e2d\uff0c\u76f8\u540cTranceId\u7684\u5173\u8054\uff0c\u6784\u5efa\u51fa\u7a0b\u5e8f\u7684\u8c03\u7528\u94fe\u4fe1\u606f</li> </ul>"},{"location":"monitoring/monitoring/#_13","title":"\u8d8b\u52bf\u5206\u6790","text":"<p>\u901a\u8fc7\u5404\u79cd\u7b97\u6cd5\u9884\u6d4b\u672a\u6765\u7684\u53d8\u5316\u8d8b\u52bf</p>"},{"location":"monitoring/monitoring/#_14","title":"\u57fa\u4e8e\u89c4\u5219\u544a\u8b66","text":"<ul> <li>\u9608\u503c\u89e6\u53d1\u544a\u8b66</li> <li>\u5f02\u5e38\u544a\u8b66</li> <li>\u544a\u8b66\u6291\u5236\u2014\u2014\u76f8\u540c\u544a\u8b66</li> <li>\u544a\u8b66\u6536\u655b\u2014\u2014\u6839\u95ee\u9898\u89e6\u53d1\u7684\u4e00\u7cfb\u5217\u5b50\u95ee\u9898</li> <li>\u544a\u8b66\u6062\u590d</li> </ul>"},{"location":"monitoring/monitoring/#_15","title":"\u76d1\u63a7\u7cfb\u7edf\u7684\u53d1\u5c55\u8d8b\u52bf","text":"<p>\u95ee\u9898\uff1a</p> <ul> <li>\u76d1\u63a7\u7cfb\u7edf\u63d0\u4f9b\u7684\u5bf9\u5355\u4e2a\u6307\u6807\u7684\u76d1\u63a7\u5e76\u4e0d\u80fd\u5f88\u597d\u5730\u53cd\u6620\u8fd0\u884c\u7cfb\u7edf\u548c\u7a0b\u5e8f\u7684\u5f53\u524d\u72b6\u6001\u3002</li> <li>\u544a\u8b66\u90fd\u662f\u53d1\u751f\u5728\u6545\u969c\u4e4b\u540e\uff0c\u4e0d\u80fd\u63d0\u524d\u9884\u8b66</li> <li>\u544a\u8b66\u4e4b\u540e\uff0c\u8fd0\u7ef4\u4eba\u5458\u9700\u8981\u7efc\u5408\u5206\u6790\u6765\u786e\u5b9a\u95ee\u9898\uff0c\u5ef6\u957f\u95ee\u9898\u89e3\u51b3\u5f97\u65f6\u95f4</li> </ul> <p>\u4f20\u7edf\u8fd0\u7ef4\uff1a\u6027\u80fd\u76d1\u63a7\u3001\u5065\u5eb7\u72b6\u6001\u76d1\u63a7\u3001\u5e94\u7528\u76d1\u63a7\u7b49\u57fa\u7840\u80fd\u529b\u7684\u76d1\u63a7\u667a\u80fd\u76d1\u63a7\uff1a\u5177\u5907\u673a\u5668\u5b66\u4e60\u548c\u81ea\u52a8\u5316\u8fd0\u7ef4\u80fd\u529b</p> <ul> <li>\u901a\u8fc7\u591a\u79cd\u7ef4\u5ea6\u7684\u6307\u6807\u5206\u6790\u5b9a\u4f4d\u95ee\u9898\u7684\u6545\u969c\u70b9\uff1a\u786c\u4ef6\u3001\u8f6f\u4ef6\u7b49\u591a\u7ef4\u5ea6\u6307\u6807\uff0c\u51c6\u786e\u8fc5\u901f\u5b9a\u4f4d\u6545\u969c\u70b9</li> <li>\u6545\u969c\u548c\u98ce\u9669\u9884\u6d4b\uff1a\u901a\u8fc7\u5bf9\u4ee5\u5f80\u6545\u969c\u7684\u5b66\u4e60\uff0c\u9884\u6d4b\u672a\u6765\u7684\u6545\u969c\u65f6\u95f4</li> <li>AWS\u901a\u8fc7\u5bf9\u5927\u91cf\u670d\u52a1\u5668\u53d1\u751f\u6545\u969c\u7684\u65f6\u95f4\u3001\u6545\u969c\u524d\u7684\u67d0\u4e9b\u6307\u6807\u7684\u5f02\u5e38\u7b49\u5b66\u4e60\uff0c\u8fdb\u884c\u66f4\u6362\u670d\u52a1\u5668</li> <li>\u7a81\u53d1\u6d41\u91cf\uff08\u5386\u53f2\u8bf7\u6c42\u7684QPS\uff0c\u9884\u6d4b\u6d41\u91cf\u9ad8\u5cf0\uff0c\u63d0\u524d\u6269\u5bb9\uff09</li> <li>\u667a\u80fd\u5904\u7406\uff1a\u673a\u5668\u7684\u81ea\u52a8\u5316\u8fd0\u7ef4\uff0c\u4e0d\u9700\u4eba\u4e3a\u5e72\u6d89\uff0c\u673a\u5668\u5904\u7406\u6545\u969c</li> </ul> <p></p>"},{"location":"monitoring/prometheus-install/","title":"\u4e8c\u8fdb\u5236\u5305\u5b89\u88c5","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5230 Prometheus \u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\u4e0b\u8f7d\u9875\u9762\uff0c\u6839\u636e\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u4e0b\u8f7d\u5bf9\u5e94\u7684\u5b89\u88c5\u5305\u3002\u4e0b\u9762\u6211\u4eec\u5c06\u4ee5 ubuntu server \u4f5c\u4e3a\u6f14\u793a\u3002</p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#_2","title":"\u73af\u5883\u51c6\u5907","text":"<ul> <li>linux amd64 (ubuntu server)</li> <li>prometheus 2.39.1</li> </ul>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#prometheus-server","title":"\u4e0b\u8f7d Prometheus Server","text":"<p>\u521b\u5efa\u4e0b\u8f7d\u76ee\u5f55,\u4ee5\u4fbf\u5b89\u88c5\u8fc7\u540e\u6e05\u7406\u6389</p> <pre><code>mkdir ~/Download\ncd ~/Download\n</code></pre> <p>\u4f7f\u7528 wget \u4e0b\u8f7d Prometheus \u7684\u5b89\u88c5\u5305</p> <pre><code>wget https://github.com/prometheus/prometheus/releases/download/v2.39.1/prometheus-2.39.1.linux-amd64.tar.gz\n</code></pre> <p>\u521b\u5efa Prometheus \u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u653e\u6240\u6709 Prometheus \u76f8\u5173\u7684\u8fd0\u884c\u670d\u52a1</p> <pre><code>mkdir ~/Prometheus\ncd ~/Prometheus\n</code></pre> <p>\u4f7f\u7528 tar \u89e3\u538b\u7f29 prometheus-2.39.1.linux-amd64.tar.gz</p> <pre><code>tar -xvzf ~/Download/prometheus-2.39.1.linux-amd64.tar.gz\ncd prometheus-2.39.1.linux-amd64\n</code></pre> <p>\u5f53\u89e3\u538b\u7f29\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u8fd0\u884c version \u68c0\u67e5\u8fd0\u884c\u73af\u5883\u662f\u5426\u6b63\u5e38</p> <pre><code>./prometheus --version\n</code></pre> <p>\u5982\u679c\u4f60\u770b\u5230\u7c7b\u4f3c\u8f93\u51fa\uff0c\u8868\u793a\u4f60\u5df2\u5b89\u88c5\u6210\u529f:</p> <pre><code>prometheus, version 2.39.1 (branch: HEAD, revision: dcd6af9e0d56165c6f5c64ebbc1fae798d24933a)\n  build user:       root@273d60c69592\n  build date:       20221007-15:57:09\n  go version:       go1.19.2\n  platform:         linux/amd64\n</code></pre>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#prometheus-server_1","title":"\u542f\u52a8 Prometheus Server","text":"<pre><code>./prometheus\n</code></pre> <p>\u5982\u679c prometheus \u6b63\u5e38\u542f\u52a8\uff0c\u4f60\u5c06\u770b\u5230\u5982\u4e0b\u4fe1\u606f\uff1a</p> <pre><code>ts=2022-10-14T13:51:37.618Z caller=main.go:499 level=info msg=\"No time or size retention was set so using the default time retention\" duration=15d\nts=2022-10-14T13:51:37.621Z caller=main.go:543 level=info msg=\"Starting Prometheus Server\" mode=server version=\"(version=2.39.1, branch=HEAD, revision=dcd6af9e0d56165c6f5c64ebbc1fae798d24933a)\"\nts=2022-10-14T13:51:37.622Z caller=main.go:548 level=info build_context=\"(go=go1.19.2, user=root@273d60c69592, date=20221007-15:57:09)\"\nts=2022-10-14T13:51:37.624Z caller=main.go:549 level=info host_details=\"(Linux 4.9.184-linuxkit #1 SMP Tue Jul 2 22:58:16 UTC 2019 x86_64 c22888a5ec8e (none))\"\nts=2022-10-14T13:51:37.625Z caller=main.go:550 level=info fd_limits=\"(soft=1048576, hard=1048576)\"\nts=2022-10-14T13:51:37.627Z caller=main.go:551 level=info vm_limits=\"(soft=unlimited, hard=unlimited)\"\nts=2022-10-14T13:51:37.644Z caller=web.go:559 level=info component=web msg=\"Start listening for connections\" address=0.0.0.0:9090\n</code></pre> <p>\u901a\u8fc7\u542f\u52a8\u65e5\u5fd7\uff0c\u53ef\u4ee5\u770b\u5230 Prometheus Server \u9ed8\u8ba4\u7aef\u53e3\u662f 9090\u3002</p> <p>\u5f53 Prometheus \u542f\u52a8\u540e\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u6765\u8bbf\u95ee  <code>http://IP:9090</code>\uff0c\u5c06\u770b\u5230\u5982\u4e0b\u9875\u9762</p> <p></p> <p>\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u6dfb\u52a0\u4e86 Prometheus Server \u7684\u76d1\u63a7\uff0c\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 <code>PromQL</code> \uff08Prometheus Query Language\uff09\u6765\u67e5\u770b\uff0c\u6bd4\u5982\uff1a</p> <p></p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#_3","title":"\u603b\u7ed3","text":"<ol> <li>\u53ef\u4ee5\u770b\u51fa Prometheus \u4e8c\u8fdb\u5236\u5b89\u88c5\u975e\u5e38\u65b9\u4fbf\uff0c\u6ca1\u6709\u4f9d\u8d56\uff0c\u81ea\u5e26\u67e5\u8be2 web \u754c\u9762\u3002</li> <li>\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Prometheus \u6dfb\u52a0\u5230 init \u914d\u7f6e\u91cc\uff0c\u6216\u8005\u4f7f\u7528 supervisord \u4f5c\u4e3a\u670d\u52a1\u81ea\u542f\u52a8\u3002</li> </ol>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#docker","title":"Docker \u5b89\u88c5","text":"<p>\u9996\u5148\u786e\u4fdd\u4f60\u5df2\u5b89\u88c5\u4e86\u6700\u65b0\u7248\u672c\u7684 Docker, \u5982\u679c\u6ca1\u6709\u5b89\u88c5\u8bf7\u70b9\u51fb\u8fd9\u91cc\u3002</p> <p>\u4e0b\u9762\u6211\u5c06\u4ee5 Mac \u7248\u672c\u7684 Docker \u4f5c\u4e3a\u6f14\u793a\u3002</p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#_4","title":"\u5b89\u88c5","text":"<p>Docker \u955c\u50cf\u5730\u5740 Quay.io</p> <p>\u6267\u884c\u547d\u4ee4\u5b89\u88c5:</p> <pre><code>$ docker run --name prometheus -d -p 9090:9090 quay.io/prometheus/prometheus:v2.39.1\n</code></pre> <p>\u5982\u679c\u5b89\u88c5\u6210\u529f\u4f60\u53ef\u4ee5\u8bbf\u95ee <code>127.0.0.1:9090</code> \u67e5\u770b\u5230\u8be5\u9875\u9762:</p> <p></p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#docker-prometheus","title":"Docker \u7ba1\u7406 prometheus","text":"<p>\u8fd0\u884c docker ps \u67e5\u770b\u6240\u6709\u670d\u52a1:</p> <pre><code>CONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS              PORTS                      NAMES\ne9ebc2435387        quay.io/prometheus/prometheus   \"/bin/prometheus -...\"   26 minutes ago      Up 26 minutes       127.0.0.1:9090-&gt;9090/tcp   prometheus\n</code></pre> <p>\u8fd0\u884c <code>docker start prometheus</code> \u542f\u52a8\u670d\u52a1</p> <p>\u8fd0\u884c <code>docker stats prometheus</code> \u67e5\u770b prometheus \u72b6\u6001</p> <p>\u8fd0\u884c <code>docker stop prometheus</code> \u505c\u6b62\u670d\u52a1</p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#docker_1","title":"Docker \u955c\u50cf\u914d\u7f6e\u53c2\u6570","text":"<p>\u901a\u8fc7 Prometheus \u7684 Dockerfile\u53ef\u4ee5\u53d1\u73b0\uff0c\u5176\u8fd0\u884c\u547d\u4ee4\u4e3a /bin/prometheus\uff0c\u5e76\u5305\u542b\u4e864\u4e2a\u9ed8\u8ba4\u542f\u52a8\u53c2\u6570\uff1a</p> <pre><code>ENTRYPOINT [ \"/bin/prometheus\" ]\nCMD        [ \"--config.file=/etc/prometheus/prometheus.yml\", \\\n             \"--storage.tsdb.path=/prometheus\", \\\n             \"--web.console.libraries=/usr/share/prometheus/console_libraries\", \\\n             \"--web.console.templates=/usr/share/prometheus/consoles\" ]\n</code></pre> <p>\u6240\u4ee5\uff0c\u5f53\u6211\u4eec\u8981\u4fee\u6539\u914d\u7f6e Prometheus \u7684\u542f\u52a8\u53c2\u6570\uff0c\u76f4\u63a5\u8986\u76d6\u6389\u9ed8\u8ba4\u7684\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u548c\u5b58\u50a8\u76ee\u5f55</li> </ul> <pre><code>docker run --name prometheus\n    -v=$(pwd)/examples/prometheus.yml:/etc/prometheus/prometheus.yml \\\n    -v=$(pwd)/examples/tsdb:/prometheus \\\n    -d -p 9090:9090 \\\n    quay.io/prometheus/prometheus:v2.39.1\n</code></pre> <p>\u6b64\u65f6\u5728 <code>$(pwd)/examples</code> \u76ee\u5f55\u4e0b\u5c06\u751f\u4ea7\u4e00\u4e2a tsdb \u76ee\u5f55\uff0c\u5b58\u50a8 Promtheus \u65f6\u5e8f\u6570\u636e\u3002</p> <ul> <li>\u5f00\u542f Lifecycle API</li> </ul> <p>\u66f4\u65b0\u542f\u52a8\u547d\u4ee4\uff0c\u6dfb\u52a0 <code>--web.enable-lifecycle</code> \u547d\u4ee4\u53c2\u6570\uff1a</p> <pre><code>docker run --name prometheus \\\n    -v=$(pwd)/examples/prometheus.yml:/etc/prometheus/prometheus.yml \\\n    -v=$(pwd)/examples/tsdb:/prometheus \\\n    -d -p 9090:9090 \\\n    quay.io/prometheus/prometheus:v2.39.1 \\\n    --config.file=/etc/prometheus/prometheus.yml \\\n    --storage.tsdb.path=/prometheus \\\n    --web.console.libraries=/usr/share/prometheus/console_libraries \\\n    --web.console.templates=/usr/share/prometheus/consoles \\\n    --web.enable-lifecycle\n</code></pre> <p>\u5f53\u91cd\u65b0\u6267\u884c Docker \u547d\u4ee4\u540e\u5e76\u66f4\u65b0 <code>examples/prometheus.yml</code> \u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>curl -X POST http://localhost:9090/-/reload</code> \u52a8\u6001\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u3002</p>","tags":["prometheus","install"]},{"location":"monitoring/prometheus-install/#kube-prometheus","title":"kube-prometheus\u5b89\u88c5","text":"","tags":["prometheus","install"]},{"location":"monitoring/prometheus-intro/","title":"\u4ec0\u4e48\u662f Prometheus","text":"<p>Prometheus \u662f\u7531 SoundCloud \u5f00\u6e90\u76d1\u63a7\u544a\u8b66\u89e3\u51b3\u65b9\u6848\uff0c\u4ece 2012 \u5e74\u5f00\u59cb\u7f16\u5199\u4ee3\u7801\uff0c\u518d\u5230 2015 \u5e74 github \u4e0a\u5f00\u6e90\u4ee5\u6765\uff0c\u5df2\u7ecf\u5438\u5f15\u4e86 9k+ \u5173\u6ce8\uff0c\u4ee5\u53ca\u5f88\u591a\u5927\u516c\u53f8\u7684\u4f7f\u7528\uff1b2016 \u5e74 Prometheus \u6210\u4e3a\u7ee7 k8s \u540e\uff0c\u7b2c\u4e8c\u540d CNCF\\([Cloud Native Computing Foundation](https://cncf.io/)\\) \u6210\u5458\u3002</p> <p>\u4f5c\u4e3a\u65b0\u4e00\u4ee3\u5f00\u6e90\u89e3\u51b3\u65b9\u6848\uff0c\u5f88\u591a\u7406\u5ff5\u4e0e Google SRE \u8fd0\u7ef4\u4e4b\u9053\u4e0d\u8c0b\u800c\u5408\u3002</p>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#_1","title":"\u4e3b\u8981\u529f\u80fd","text":"<ul> <li>\u591a\u7ef4 \u6570\u636e\u6a21\u578b\uff08\u65f6\u5e8f\u7531 metric \u540d\u5b57\u548c k/v \u7684 labels \u6784\u6210\uff09\u3002</li> <li>\u7075\u6d3b\u7684\u67e5\u8be2\u8bed\u53e5\uff08PromQL\uff09\u3002</li> <li>\u65e0\u4f9d\u8d56\u5b58\u50a8\uff0c\u652f\u6301 local \u548c remote \u4e0d\u540c\u6a21\u578b\u3002</li> <li>\u91c7\u7528 http \u534f\u8bae\uff0c\u4f7f\u7528 pull \u6a21\u5f0f\uff0c\u62c9\u53d6\u6570\u636e\uff0c\u7b80\u5355\u6613\u61c2\u3002</li> <li>\u76d1\u63a7\u76ee\u6807\uff0c\u53ef\u4ee5\u91c7\u7528\u670d\u52a1\u53d1\u73b0\u6216\u9759\u6001\u914d\u7f6e\u7684\u65b9\u5f0f\u3002</li> <li>\u652f\u6301\u591a\u79cd\u7edf\u8ba1\u6570\u636e\u6a21\u578b\uff0c\u56fe\u5f62\u5316\u53cb\u597d\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#_2","title":"\u6838\u5fc3\u7ec4\u4ef6","text":"<ul> <li>Prometheus Server\uff0c \u4e3b\u8981\u7528\u4e8e\u6293\u53d6\u6570\u636e\u548c\u5b58\u50a8\u65f6\u5e8f\u6570\u636e\uff0c\u53e6\u5916\u8fd8\u63d0\u4f9b\u67e5\u8be2\u548c Alert Rule \u914d\u7f6e\u7ba1\u7406\u3002</li> <li>client libraries\uff0c\u7528\u4e8e\u5bf9\u63a5 Prometheus Server, \u53ef\u4ee5\u67e5\u8be2\u548c\u4e0a\u62a5\u6570\u636e\u3002</li> <li>push gateway \uff0c\u7528\u4e8e\u6279\u91cf\uff0c\u77ed\u671f\u7684\u76d1\u63a7\u6570\u636e\u7684\u6c47\u603b\u8282\u70b9\uff0c\u4e3b\u8981\u7528\u4e8e\u4e1a\u52a1\u6570\u636e\u6c47\u62a5\u7b49\u3002</li> <li>\u5404\u79cd\u6c47\u62a5\u6570\u636e\u7684 exporters \uff0c\u4f8b\u5982\u6c47\u62a5\u673a\u5668\u6570\u636e\u7684 node_exporter,  \u6c47\u62a5 MongoDB \u4fe1\u606f\u7684 MongoDB exporter \u7b49\u7b49\u3002</li> <li>\u7528\u4e8e\u544a\u8b66\u901a\u77e5\u7ba1\u7406\u7684 alertmanager \u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#_3","title":"\u57fa\u7840\u67b6\u6784","text":"<p>\u4e00\u56fe\u80dc\u5343\u8a00\uff0c\u5148\u6765\u5f20\u5b98\u65b9\u7684\u67b6\u6784\u56fe</p> <p></p> <p>\u4ece\u8fd9\u4e2a\u67b6\u6784\u56fe\uff0c\u4e5f\u53ef\u4ee5\u770b\u51fa Prometheus \u7684\u4e3b\u8981\u6a21\u5757\u5305\u542b\uff0c Server,  Exporters, Pushgateway, PromQL, Alertmanager, WebUI \u7b49\u3002</p> <p>\u5b83\u5927\u81f4\u4f7f\u7528\u903b\u8f91\u662f\u8fd9\u6837\uff1a</p> <ol> <li>Prometheus server \u5b9a\u671f\u4ece\u9759\u6001\u914d\u7f6e\u7684 targets \u6216\u8005\u670d\u52a1\u53d1\u73b0\u7684 targets \u62c9\u53d6\u6570\u636e\u3002</li> <li>\u5f53\u65b0\u62c9\u53d6\u7684\u6570\u636e\u5927\u4e8e\u914d\u7f6e\u5185\u5b58\u7f13\u5b58\u533a\u7684\u65f6\u5019\uff0cPrometheus \u4f1a\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff08\u5982\u679c\u4f7f\u7528 remote storage \u5c06\u6301\u4e45\u5316\u5230\u4e91\u7aef\uff09\u3002</li> <li>Prometheus \u53ef\u4ee5\u914d\u7f6e rules\uff0c\u7136\u540e\u5b9a\u65f6\u67e5\u8be2\u6570\u636e\uff0c\u5f53\u6761\u4ef6\u89e6\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u5c06 alert \u63a8\u9001\u5230\u914d\u7f6e\u7684 Alertmanager\u3002</li> <li>Alertmanager \u6536\u5230\u8b66\u544a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6839\u636e\u914d\u7f6e\uff0c\u805a\u5408\uff0c\u53bb\u91cd\uff0c\u964d\u566a\uff0c\u6700\u540e\u53d1\u9001\u8b66\u544a\u3002</li> <li>\u53ef\u4ee5\u4f7f\u7528 API\uff0c Prometheus Console \u6216\u8005 Grafana \u67e5\u8be2\u548c\u805a\u5408\u6570\u636e\u3002</li> </ol>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#_4","title":"\u6ce8\u610f","text":"<ul> <li>Prometheus \u7684\u6570\u636e\u662f\u57fa\u4e8e\u65f6\u5e8f\u7684 float64 \u7684\u503c\uff0c\u5982\u679c\u4f60\u7684\u6570\u636e\u503c\u6709\u66f4\u591a\u7c7b\u578b\uff0c\u65e0\u6cd5\u6ee1\u8db3\u3002</li> <li>Prometheus \u4e0d\u9002\u5408\u505a\u5ba1\u8ba1\u8ba1\u8d39\uff0c\u56e0\u4e3a\u5b83\u7684\u6570\u636e\u662f\u6309\u4e00\u5b9a\u65f6\u95f4\u91c7\u96c6\u7684\uff0c\u5173\u6ce8\u7684\u66f4\u591a\u662f\u7cfb\u7edf\u7684\u8fd0\u884c\u77ac\u65f6\u72b6\u6001\u4ee5\u53ca\u8d8b\u52bf\uff0c\u5373\u4f7f\u6709\u5c11\u91cf\u6570\u636e\u6ca1\u6709\u91c7\u96c6\u4e5f\u80fd\u5bb9\u5fcd\uff0c\u4f46\u662f\u5ba1\u8ba1\u8ba1\u8d39\u9700\u8981\u8bb0\u5f55\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u5e76\u4e14\u6570\u636e\u957f\u671f\u5b58\u50a8\uff0c\u8fd9\u4e2a Prometheus \u65e0\u6cd5\u6ee1\u8db3\uff0c\u53ef\u80fd\u9700\u8981\u91c7\u7528\u4e13\u95e8\u7684\u5ba1\u8ba1\u7cfb\u7edf\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus_1","title":"\u4e3a\u4ec0\u4e48\u9009\u62e9 Prometheus","text":"<p>\u5728\u524d\u8a00\u4e2d\uff0c\u7b80\u5355\u4ecb\u7ecd\u4e86\u6211\u4eec\u9009\u62e9 Prometheus \u7684\u7406\u7531\uff0c\u4ee5\u53ca\u4f7f\u7528\u540e\u7ed9\u6211\u4eec\u5e26\u6765\u7684\u597d\u5904\u3002</p> <p>\u5728\u8fd9\u91cc\u4e3b\u8981\u548c\u5176\u4ed6\u76d1\u63a7\u65b9\u6848\u5bf9\u6bd4\uff0c\u65b9\u4fbf\u5927\u5bb6\u66f4\u597d\u7684\u4e86\u89e3 Prometheus\u3002</p>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-zabbix","title":"Prometheus vs Zabbix","text":"<ul> <li>Zabbix \u4f7f\u7528\u7684\u662f C \u548c PHP, Prometheus \u4f7f\u7528 Golang, \u6574\u4f53\u800c\u8a00 Prometheus \u8fd0\u884c\u901f\u5ea6\u66f4\u5feb\u4e00\u70b9\u3002</li> <li>Zabbix \u5c5e\u4e8e\u4f20\u7edf\u4e3b\u673a\u76d1\u63a7\uff0c\u4e3b\u8981\u7528\u4e8e\u7269\u7406\u4e3b\u673a\uff0c\u4ea4\u6362\u673a\uff0c\u7f51\u7edc\u7b49\u76d1\u63a7\uff0cPrometheus \u4e0d\u4ec5\u9002\u7528\u4e3b\u673a\u76d1\u63a7\uff0c\u8fd8\u9002\u7528\u4e8e Cloud, SaaS, Openstack\uff0cContainer \u76d1\u63a7\u3002</li> <li>Zabbix \u5728\u4f20\u7edf\u4e3b\u673a\u76d1\u63a7\u65b9\u9762\uff0c\u6709\u66f4\u4e30\u5bcc\u7684\u63d2\u4ef6\u3002</li> <li>Zabbix \u53ef\u4ee5\u5728 WebGui \u4e2d\u914d\u7f6e\u5f88\u591a\u5185\u5bb9\uff0c\u4f46\u662f Prometheus \u9700\u8981\u624b\u52a8\u4fee\u6539\u6587\u4ef6\u914d\u7f6e\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-graphite","title":"Prometheus vs Graphite","text":"<ul> <li>Graphite \u529f\u80fd\u8f83\u5c11\uff0c\u5b83\u4e13\u6ce8\u4e8e\u4e24\u4ef6\u4e8b\uff0c\u5b58\u50a8\u65f6\u5e8f\u6570\u636e\uff0c \u53ef\u89c6\u5316\u6570\u636e\uff0c\u5176\u4ed6\u529f\u80fd\u9700\u8981\u5b89\u88c5\u76f8\u5173\u63d2\u4ef6\uff0c\u800c Prometheus \u5c5e\u4e8e\u4e00\u7ad9\u5f0f\uff0c\u63d0\u4f9b\u544a\u8b66\u548c\u8d8b\u52bf\u5206\u6790\u7684\u5e38\u89c1\u529f\u80fd\uff0c\u5b83\u63d0\u4f9b\u66f4\u5f3a\u7684\u6570\u636e\u5b58\u50a8\u548c\u67e5\u8be2\u80fd\u529b\u3002</li> <li>\u5728\u6c34\u5e73\u6269\u5c55\u65b9\u6848\u4ee5\u53ca\u6570\u636e\u5b58\u50a8\u5468\u671f\u4e0a\uff0cGraphite \u505a\u7684\u66f4\u597d\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-influxdb","title":"Prometheus vs InfluxDB","text":"<ul> <li>InfluxDB \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u6570\u636e\uff0c\u5982\u679c\u60f3\u642d\u5efa\u76d1\u63a7\u544a\u8b66\u7cfb\u7edf\uff0c \u9700\u8981\u4f9d\u8d56\u5176\u4ed6\u7cfb\u7edf\u3002</li> <li>InfluxDB \u5728\u5b58\u50a8\u6c34\u5e73\u6269\u5c55\u4ee5\u53ca\u9ad8\u53ef\u7528\u65b9\u9762\u505a\u7684\u66f4\u597d, \u6bd5\u7adf\u6838\u5fc3\u662f\u6570\u636e\u5e93\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-opentsdb","title":"Prometheus vs OpenTSDB","text":"<ul> <li>OpenTSDB \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u5b83\u4f9d\u8d56 Hadoop \u548c HBase\uff0c\u80fd\u5b58\u50a8\u66f4\u957f\u4e45\u6570\u636e\uff0c \u5982\u679c\u4f60\u7cfb\u7edf\u5df2\u7ecf\u8fd0\u884c\u4e86 Hadoop \u548c HBase, \u5b83\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</li> <li>\u5982\u679c\u60f3\u642d\u5efa\u76d1\u63a7\u544a\u8b66\u7cfb\u7edf\uff0cOpenTSDB \u9700\u8981\u4f9d\u8d56\u5176\u4ed6\u7cfb\u7edf\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-nagios","title":"Prometheus vs Nagios","text":"<ul> <li>Nagios \u6570\u636e\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49 Labels, \u4e0d\u652f\u6301\u67e5\u8be2\uff0c\u544a\u8b66\u4e5f\u4e0d\u652f\u6301\u53bb\u566a\uff0c\u5206\u7ec4, \u6ca1\u6709\u6570\u636e\u5b58\u50a8\uff0c\u5982\u679c\u60f3\u67e5\u8be2\u5386\u53f2\u72b6\u6001\uff0c\u9700\u8981\u5b89\u88c5\u63d2\u4ef6\u3002</li> <li>Nagios \u662f\u4e0a\u4e16\u7eaa 90 \u5e74\u4ee3\u7684\u76d1\u63a7\u7cfb\u7edf\uff0c\u6bd4\u8f83\u9002\u5408\u5c0f\u96c6\u7fa4\u6216\u9759\u6001\u7cfb\u7edf\u7684\u76d1\u63a7\uff0c\u663e\u7136 Nagios \u592a\u53e4\u8001\u4e86\uff0c\u5f88\u591a\u7279\u6027\u90fd\u6ca1\u6709\uff0c\u76f8\u6bd4\u4e4b\u4e0bPrometheus \u8981\u4f18\u79c0\u5f88\u591a\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#prometheus-vs-sensu","title":"Prometheus vs Sensu","text":"<ul> <li>Sensu \u5e7f\u4e49\u4e0a\u8bb2\u662f Nagios \u7684\u5347\u7ea7\u7248\u672c\uff0c\u5b83\u89e3\u51b3\u4e86\u5f88\u591a Nagios \u7684\u95ee\u9898\uff0c\u5982\u679c\u4f60\u5bf9 Nagios \u5f88\u719f\u6089\uff0c\u4f7f\u7528 Sensu \u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002</li> <li>Sensu \u4f9d\u8d56 RabbitMQ \u548c Redis\uff0c\u6570\u636e\u5b58\u50a8\u4e0a\u6269\u5c55\u6027\u66f4\u597d\u3002</li> </ul>","tags":["prometheus"]},{"location":"monitoring/prometheus-intro/#_5","title":"\u603b\u7ed3","text":"<ul> <li>Prometheus \u5c5e\u4e8e\u4e00\u7ad9\u5f0f\u76d1\u63a7\u544a\u8b66\u5e73\u53f0\uff0c\u4f9d\u8d56\u5c11\uff0c\u529f\u80fd\u9f50\u5168\u3002</li> <li>Prometheus \u652f\u6301\u5bf9\u4e91\u6216\u5bb9\u5668\u7684\u76d1\u63a7\uff0c\u5176\u4ed6\u7cfb\u7edf\u4e3b\u8981\u5bf9\u4e3b\u673a\u76d1\u63a7\u3002</li> <li>Prometheus \u6570\u636e\u67e5\u8be2\u8bed\u53e5\u8868\u73b0\u529b\u66f4\u5f3a\u5927\uff0c\u5185\u7f6e\u66f4\u5f3a\u5927\u7684\u7edf\u8ba1\u51fd\u6570\u3002</li> <li>Prometheus \u5728\u6570\u636e\u5b58\u50a8\u6269\u5c55\u6027\u4ee5\u53ca\u6301\u4e45\u6027\u4e0a\u6ca1\u6709 InfluxDB\uff0cOpenTSDB\uff0cSensu \u597d\u3002</li> </ul>","tags":["prometheus"]},{"location":"blog/archive/2024/","title":"2024","text":""},{"location":"blog/category/tools/","title":"tools","text":""},{"location":"tags/","title":"Tags","text":"<p>Following is a list of relevant tags:</p>"},{"location":"tags/#cadvisor","title":"cadvisor","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#install","title":"install","text":"<ul> <li>prometheus\u5b89\u88c5</li> </ul>"},{"location":"tags/#kube-state-metrics","title":"kube-state-metrics","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#metrics","title":"metrics","text":"<ul> <li>k8s-metrics</li> </ul>"},{"location":"tags/#mkdocs","title":"mkdocs","text":"<ul> <li>mkdocs\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#prometheus","title":"prometheus","text":"<ul> <li>prometheus\u5b89\u88c5</li> <li>prometheus\u4ecb\u7ecd</li> </ul>"},{"location":"tags/#python","title":"python","text":"<ul> <li>python\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#tools","title":"tools","text":"<ul> <li>mkdocs\u5de5\u5177\u4fe1\u606f</li> <li>python\u5de5\u5177\u4fe1\u606f</li> <li>vscode\u5de5\u5177\u4fe1\u606f</li> </ul>"},{"location":"tags/#vscode","title":"vscode","text":"<ul> <li>vscode\u5de5\u5177\u4fe1\u606f</li> </ul>"}]}